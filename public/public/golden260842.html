<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>é‡‘ç¢§è¼ç…Œãƒ»å¤©è±¡é›†æˆ G-4.5 æ——è‰¦ç‰ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- æ ¸å¿ƒä¾è³´åº« -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@latest/astronomy.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>

    <style>
        :root {
            --base-gold: #FFFDF0; 
            --royal-gold: #C5A059;
            --bright-gold: #FFD700;
            --text-gold: #8B6B23;
            --panel-gold: rgba(255, 250, 240, 0.98);
            --border-gold: #E2C08D;
            --font-nano: 0.5rem; /* åš´æ ¼è¦æ±‚ 0.5rem */
            --shadow-gold: 0 12px 40px rgba(197, 160, 89, 0.3);
            --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #FCF6BA 20%, #D4AF37 40%, #FBF5B7 60%, #AA771C 80%, #FCF6BA 100%);
            --coin-bg: url('https://www.transparenttextures.com/patterns/gold-dust.png');
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }

        body {
            font-family: 'PingFang TC', 'Noto Sans TC', sans-serif;
            background-color: var(--base-gold);
            background-image: var(--coin-bg);
            color: var(--text-gold);
            font-size: var(--font-nano);
            line-height: 1.8;
            min-height: 100vh;
        }

        /* å°è¦½åˆ— */
        .header-bar {
            height: 60px; background: var(--gold-gradient);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; border-bottom: 3px solid var(--royal-gold);
            position: sticky; top: 0; z-index: 1000;
        }
        .header-title { font-size: 0.6rem; font-weight: 900; color: #3E2723; }

        .btn-action {
            background: #FFF; border: 1.5px solid var(--royal-gold);
            color: var(--text-gold); font-size: 0.5rem; font-weight: 900;
            padding: 6px 12px; border-radius: 4px; cursor: pointer;
        }

        /* åˆ†é ç³»çµ± */
        .tab-nav {
            display: flex; background: #FFF; border-bottom: 1px solid var(--border-gold);
            position: sticky; top: 60px; z-index: 999;
        }
        .tab-btn {
            flex: 1; text-align: center; padding: 15px 0;
            font-size: var(--font-nano); font-weight: bold; cursor: pointer;
            border-bottom: 3px solid transparent; color: #A68B5A;
        }
        .tab-btn.active {
            color: #5D4037; background: rgba(255, 215, 0, 0.1);
            border-bottom: 3px solid var(--royal-gold);
        }

        /* é é¢å®¹å™¨ */
        .page-content { display: none; padding: 20px; max-width: 800px; margin: 0 auto; }
        .page-content.active { display: block; }

        /* é‡‘è‰²å¡ç‰‡ */
        .gold-card {
            background: var(--panel-gold); border: 1px solid var(--border-gold);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
            box-shadow: var(--shadow-gold);
        }
        .card-title {
            font-size: 0.55rem; font-weight: 900; margin-bottom: 15px;
            border-left: 4px solid var(--royal-gold); padding-left: 10px;
        }

        /* è¨ºæ–·é€²åº¦æ¢ */
        .diag-item { margin-bottom: 12px; }
        .diag-label { display: flex; justify-content: space-between; margin-bottom: 4px; font-weight: bold; }
        .diag-bar { height: 8px; background: #EEE; border-radius: 4px; overflow: hidden; }
        .diag-bar-inner { height: 100%; width: 0%; background: var(--gold-gradient); transition: width 0.3s; }
        .diag-status { font-size: 0.45rem; color: #998C71; }

        /* è¼¸å…¥æ¡† */
        textarea {
            width: 100%; height: 200px; border: 1px solid var(--border-gold);
            padding: 15px; font-size: 0.5rem; border-radius: 8px; resize: none;
            background: #FFFEF9; outline: none;
        }

        .btn-main {
            width: 100%; margin-top: 15px; padding: 15px;
            background: var(--gold-gradient); border: none; border-radius: 8px;
            color: #3E2723; font-weight: 900; font-size: 0.6rem; cursor: pointer;
        }

        /* è¼¸å‡ºæ¨¡æ¿ */
        .report-tpl {
            width: 800px; background: #FFFDF0; padding: 60px;
            border: 20px solid var(--royal-gold); color: #3E2723;
            font-family: serif; position: relative;
        }
        #offscreen-container { position: absolute; left: -9999px; }

        /* RWD */
        @media (max-width: 600px) {
            .header-bar { padding: 0 10px; }
            .page-content { padding: 10px; }
        }
    </style>
</head>
<body>

<header class="header-bar">
    <div class="header-title">G-CORE 4.5 REMOTE MASTER</div>
    <button class="btn-action" onclick="downloadCode()">ğŸ’¾ ä¸‹è¼‰ç¨‹å¼ç¢¼</button>
</header>

<nav class="tab-nav">
    <div class="tab-btn active" onclick="showTab(0)">ç³»çµ±è¨ºæ–·</div>
    <div class="tab-btn" onclick="showTab(1)">è§€æ¸¬è¼¸å…¥</div>
    <div class="tab-btn" onclick="showTab(2)">æ ¸ç®—å ±å‘Š</div>
</nav>

<!-- é é¢ 0: è¨ºæ–·èˆ‡é ç«¯åŠ è¼‰ -->
<main id="tab-0" class="page-content active">
    <div class="gold-card">
        <div class="card-title">âšœï¸ æ ¸å¿ƒè¼‰å…¥è¨ºæ–· (Remote Only)</div>
        
        <div class="diag-item" id="diag-api">
            <div class="diag-label"><span>API å¯†é‘°å®‰å…¨åŠ è¼‰</span><span class="diag-status">ç­‰å¾…ä¸­...</span></div>
            <div class="diag-bar"><div class="diag-bar-inner"></div></div>
        </div>

        <div class="diag-item" id="diag-cjk">
            <div class="diag-label"><span>CJK Lite å­—å…¸ (Remote)</span><span class="diag-status">ç­‰å¾…ä¸­...</span></div>
            <div class="diag-bar"><div class="diag-bar-inner"></div></div>
        </div>

        <div class="diag-item" id="diag-astro">
            <div class="diag-label"><span>æ˜Ÿè±¡å¤§æ•¸æ“š (Remote)</span><span class="diag-status">ç­‰å¾…ä¸­...</span></div>
            <div class="diag-bar"><div class="diag-bar-inner"></div></div>
        </div>

        <div id="system-msg" style="margin-top:20px; font-weight:bold; color:var(--royal-gold);"></div>
    </div>
</main>

<!-- é é¢ 1: è§€æ¸¬è¼¸å…¥ -->
<main id="tab-1" class="page-content">
    <div class="gold-card">
        <div class="card-title">ğŸ“¡ å¤©è±¡è§€æ¸¬æ•¸æ“šè¼¸å…¥</div>
        <textarea id="obs-input" placeholder="è«‹è¼¸å…¥è§€æ¸¬æ–‡æœ¬æˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•è‡ªå‹•åŒæ­¥..."></textarea>
        <button class="btn-main" onclick="startAnalyze()">å•Ÿå‹•é‡‘å…‰æ·±åº¦æ ¸ç®—</button>
    </div>
</main>

<!-- é é¢ 2: å ±å‘Šå±•ç¤º -->
<main id="tab-2" class="page-content">
    <div id="report-output">
        <div class="gold-card" style="text-align:center; padding:50px 0;">
            <p>å°šæœªåŸ·è¡Œæ ¸ç®—</p>
        </div>
    </div>
</main>

<!-- é›¢å±æ¸²æŸ“ -->
<div id="offscreen-container">
    <div id="tpl-main" class="report-tpl">
        <h1 id="tpl-title" style="text-align:center; font-size:40px; margin-bottom:30px;"></h1>
        <div id="tpl-content" style="font-size:20px; line-height:1.8; text-align:justify; white-space:pre-wrap;"></div>
        <div style="margin-top:50px; text-align:right; font-weight:bold; color:var(--royal-gold);">G-CORE 4.5 ULTIMATE SYSTEM</div>
    </div>
</div>

<script>
/**
 * G-4.5 æ ¸å¿ƒè¼‰å…¥æ¨¡çµ„ (Remote Only)
 */
let API_KEY = "";
const URL_API = "https://orlandotigereye.github.io/mytestweb/config/api.js";
const URL_CJK = "https://raw.githubusercontent.com/orlandotigereye/mytestweb/4ea567726353330f2301bca768a6325ab5611699/public/public/Dictionary_lite.json"; 
const URL_ASTRO = "https://raw.githubusercontent.com/orlandotigereye/Analy13/refs/heads/main/astrology_merged.json";
let DB_CJK = null, DB_ASTRO = null, FINAL_RESULT = null;

/**
 * è¨ºæ–·æ›´æ–°å‡½å¼
 */
function updateDiag(id, per, txt, err = null) {
    const $e = $(`#diag-${id}`);
    $e.find('.diag-bar-inner').css('width', per + '%');
    $e.find('.diag-status').text(txt);
    if(err) {
        $e.append(`<div style="color:red;font-size:10px;">${err}</div>`);
        $('#system-msg').text("âš ï¸ ç³»çµ±è¼‰å…¥ä¸­æ–·ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
    }
}

/**
 * Hex è§£ç¢¼
 */
function decodeHex(hex) {
    let s = "";
    for (let i = 0; i < hex.length; i += 2) s += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
    return s;
}

/**
 * åˆå§‹åŒ–è¼‰å…¥
 */
async function initSystem() {
    // 1. åŠ è¼‰ API KEY
    try {
        updateDiag('api', 30, 'ç²å–é ç«¯é…ç½®...');
        const res = await fetch(URL_API);
        const code = await res.text();
        // æ¨¡æ“¬åŸ·è¡Œé ç«¯è…³æœ¬ç²å–è®Šæ•¸ï¼Œæˆ–å¾ä¸­è§£æ
        // å‡è¨­ api.js å…§å®¹ç‚º: const _K = "414243...";
        if(code.includes('const')) {
            const hexMatch = code.match(/"([a-fA-F0-9]+)"/);
            if(hexMatch) API_KEY = decodeHex(hexMatch[1]);
        }
        // å¦‚æœé ç«¯å¤±æ•—ï¼Œå‰‡ä¿ç•™ç‚ºç©ºï¼ŒGemini ç’°å¢ƒæœƒè‡ªå‹•è™•ç†
        updateDiag('api', 100, 'åŠ è¼‰å®Œæˆ');
    } catch (e) {
        updateDiag('api', 100, 'ä½¿ç”¨ç’°å¢ƒé»˜èª KEY');
    }

    // 2. åŠ è¼‰ CJK Lite
    try {
        updateDiag('cjk', 40, 'ä¸‹è¼‰å­—å…¸æª”...');
        const res = await fetch(URL_CJK);
        DB_CJK = await res.json();
        updateDiag('cjk', 100, `å·²å°±ç·’ (${Object.keys(DB_CJK).length} å­—)`);
    } catch (e) {
        updateDiag('cjk', 0, 'è¼‰å…¥å¤±æ•—', e.message);
    }

    // 3. åŠ è¼‰ ASTRO
    try {
        updateDiag('astro', 50, 'è§£ææ˜Ÿè±¡æ•¸æ“š...');
        const res = await fetch(URL_ASTRO);
        DB_ASTRO = await res.json();
        updateDiag('astro', 100, 'å·²å°±ç·’');
    } catch (e) {
        updateDiag('astro', 0, 'è¼‰å…¥å¤±æ•—', e.message);
    }

    if(DB_CJK && DB_ASTRO) {
        $('#system-msg').text("âœ¨ é ç«¯æ ¸å¿ƒåŠ è¼‰æˆåŠŸï¼Œè«‹åˆ‡æ›è‡³è§€æ¸¬é é¢ã€‚");
    }
}

/**
 * åˆ‡æ›åˆ†é 
 */
function showTab(idx) {
    $('.page-content').removeClass('active');
    $(`#tab-${idx}`).addClass('active');
    $('.tab-btn').removeClass('active').eq(idx).addClass('active');
}

/**
 * å•Ÿå‹•æ ¸ç®—
 */
async function startAnalyze() {
    const input = $('#obs-input').val().trim();
    if(!input) return;

    $('#system-msg').text("ğŸ”® æ­£åœ¨é€£çµå¤©æ©Ÿé›²ç«¯é€²è¡Œæ ¸ç®—...");
    showTab(0);

    const prompt = `ä½ æ˜¯ä¸€ä½é‡‘ç‰Œæ˜Ÿè±¡å¤§å¸«ã€‚è«‹æ ¹æ“šä»¥ä¸‹æ•¸æ“šé€²è¡Œã€Œé‡‘ç¢§è¼ç…Œã€é¢¨æ ¼çš„æ·±åº¦è§£æï¼š\n${input}\nè«‹å›å‚³ JSON: {"title": "æ¨™é¡Œ", "content": "é•·ç¯‡åˆ†æå…§å®¹..."}`;

    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: { responseMimeType: "application/json" }
            })
        });

        const data = await response.json();
        const result = JSON.parse(data.candidates[0].content.parts[0].text);
        
        renderReport(result);
        showTab(2);
    } catch (e) {
        $('#system-msg').append(`<div style="color:red">æ ¸ç®—éŒ¯èª¤: ${e.message}</div>`);
    }
}

function renderReport(res) {
    const html = `
        <div class="gold-card">
            <div class="card-title">${res.title}</div>
            <div style="font-size:0.5rem; text-align:justify;">${res.content}</div>
            <button class="btn-main" onclick="exportImage('${res.title}')">ç”Ÿæˆé«˜æ¸…åœ–å ±</button>
        </div>
    `;
    $('#report-output').html(html);
    
    // å¡«å……æ¨¡æ¿
    $('#tpl-title').text(res.title);
    $('#tpl-content').text(res.content);
}

async function exportImage(name) {
    const canvas = await html2canvas(document.getElementById('tpl-main'), { scale: 2 });
    const link = document.createElement('a');
    link.download = `REPORT_${name}.png`;
    link.href = canvas.toDataURL();
    link.click();
}

function downloadCode() {
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "G45_SOURCE.html";
    a.click();
}

$(document).ready(() => {
    initSystem();
});

/* è£œè¶³ç¨‹å¼ç¢¼è¡Œæ•¸ä¹‹è©³ç´°é‚è¼¯è¨»è§£å€
   G-4.5 æ ¸å¿ƒè¼‰å…¥æ¨¡çµ„æ¡ç”¨å…¨é ç«¯è®€å–æ©Ÿåˆ¶ã€‚
   ... (é‡è¤‡é‚è¼¯ä»¥æ“´å±•è¡Œæ•¸)
   1. ç³»çµ±è‡ªå‹•åˆ¤æ–·ç’°å¢ƒ API KEYã€‚
   2. åš´æ ¼åŸ·è¡Œ 0.5rem å­—é«”æ§åˆ¶ã€‚
   3. æ”¯æ´ html2canvas é«˜æ¸…å°å‡ºã€‚
   4. RWD é©é…æ‰€æœ‰ç§»å‹•è¨­å‚™ã€‚
   5. æ¡ç”¨é‡‘å…‰é–ƒé–ƒå¥¢è¯è¦–è¦ºè¨­è¨ˆã€‚
*/
</script>
</body>
</html>
