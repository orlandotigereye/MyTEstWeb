<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zinzino é‡‘é‘½åŒæ­¥ç¶­è­·å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
    <style>
        :root {
            --gold-primary: #FFD700;
            --gold-dark: #B8860B;
            --gold-light: #FFFACD;
            --text-size: 0.5rem;
        }
        body {
            background: radial-gradient(circle, #fff9e6 0%, #ffe88d 100%);
            background-attachment: fixed;
            font-family: "Microsoft JhengHei", "Apple LiGothic", sans-serif;
            color: #5d4037;
            margin: 0;
            padding: 0;
            font-size: var(--text-size);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .gold-panel {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(184, 134, 11, 0.2));
            border: 1px solid var(--gold-primary);
            box-shadow: 0 2px 10px rgba(218, 165, 32, 0.3);
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        .coin-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.2;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="%23DAA520" stroke-width="1.5" fill="none"/><path d="M50 30 v40 M40 40 h20 M40 60 h20" stroke="%23DAA520" stroke-width="1.5"/></svg>');
        }
        .tab-nav {
            display: flex;
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.96);
            border-bottom: 2px solid var(--gold-primary);
            scrollbar-width: none;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab-nav::-webkit-scrollbar { display: none; }
        .tab-item {
            padding: 12px 14px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: bold;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: var(--text-size);
            flex-shrink: 0;
        }
        .tab-item.active {
            border-bottom-color: var(--gold-dark);
            background: rgba(255, 215, 0, 0.4);
            color: var(--gold-dark);
        }
        .page-content { display: none; padding: 8px; min-height: 85vh; width: 100%; }
        .page-content.active { display: block; }
        
        .btn-gold {
            background: linear-gradient(to bottom, #ffd700, #daa520);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: var(--text-size);
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            border: 0.5px solid var(--gold-dark);
            cursor: pointer;
        }
        .input-gold {
            background: #fffdf0;
            border: 1px solid var(--gold-primary);
            padding: 4px 6px;
            border-radius: 6px;
            font-size: var(--text-size);
            color: #5d4037;
        }
        table { width: 100%; border-collapse: collapse; background: white; margin: 0; }
        th, td { border: 0.5px solid rgba(218, 165, 32, 0.3); padding: 4px; text-align: center; font-size: var(--text-size); line-height: 1.2; }
        th { background: rgba(255, 250, 205, 1); color: #856404; font-weight: 900; }

        .product-card {
            background: white;
            border: 1px solid var(--gold-primary);
            border-radius: 8px;
            padding: 4px;
            text-align: center;
            position: relative;
            min-height: 65px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .recommendation-tag {
            background: #e11d48;
            color: white;
            font-size: 0.35rem;
            padding: 1px 3px;
            border-radius: 2px;
            position: absolute;
            top: 2px; right: 2px;
        }
        .chart-wrapper { position: relative; width: 100%; height: 260px; margin: 0 auto; }
        .loading-spinner { width: 12px; height: 12px; border: 2px solid rgba(184, 134, 11, 0.3); border-radius: 50%; border-top-color: var(--gold-dark); animation: spin 1s infinite linear; display: inline-block; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .spark-container { width: 50px; height: 10px; background: #f0f0f0; border-radius: 5px; position: relative; overflow: hidden; margin: 0 auto; border: 0.5px solid #ddd; }
        .spark-target { position: absolute; height: 100%; background: rgba(34, 197, 94, 0.3); }
        .spark-value { position: absolute; height: 100%; width: 3px; background: #b45309; z-index: 10; transition: left 0.5s ease; border-radius: 1px; }
        
        .diet-cell { text-align: left; padding: 6px 4px; vertical-align: top; }
        .diet-header { font-weight: bold; color: #b45309; margin-bottom: 2px; display: block; border-bottom: 0.5px solid #eee; }
        .online-source { display: block; margin-top: 4px; color: #2563eb; text-decoration: underline; font-style: italic; font-size: 0.45rem; }
        
        .acid-group-header { background: #fef3c7; font-weight: bold; color: #92400e; text-align: left; padding-left: 8px; font-size: 0.55rem; }
    </style>
</head>
<body>
    <div class="coin-bg"></div>
    <div class="max-w-md mx-auto min-h-screen pb-10">
        
        <!-- Top Products Bar -->
        <section class="p-2">
            <div class="gold-panel p-2">
                <p class="font-bold text-center text-yellow-900 mb-1" style="font-size: 0.55rem;">ğŸŒŸ é‡‘é‘½åŒæ­¥ç”¢å“é€£å‹•ç³»çµ±</p>
                <div class="grid grid-cols-4 gap-1" id="product-recommendations"></div>
            </div>
        </section>

        <!-- Header -->
        <header class="p-2">
            <div class="gold-panel p-3 text-center">
                <h1 class="font-bold text-yellow-950 tracking-tighter" style="font-size: 0.65rem;">Zinzino Full Report Synced Hub</h1>
                <div class="mt-3 space-y-2">
                    <div class="flex gap-2">
                        <select id="id-preset" class="input-gold flex-1" onchange="syncInput(this.value)">
                            <option value="">å¿«é€Ÿé¸æ“‡æ¸¬è©¦ ID</option>
                            <option value="22GF83743634BT">é«˜åº¦å¤±è¡¡ (22GF...)</option>
                            <option value="92FK85327356BT">å¥åº·é”æ¨™ (92FK...)</option>
                        </select>
                        <button class="btn-gold flex-1" id="fetch-btn" onclick="executeFetch()">
                            <span id="btn-text">åŒæ­¥ 11 é …å®Œæ•´æ•¸æ“š</span>
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="id-input" class="input-gold flex-1" placeholder="è¼¸å…¥æª¢æ¸¬ ID" value="22GF83743634BT">
                        <button class="btn-gold" onclick="downloadCode()">ä¸‹è¼‰å®Œæ•´æª”æ¡ˆ</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tab-nav">
            <div class="tab-item active" onclick="switchTab(0)">åˆ†æçœ‹æ¿</div>
            <div class="tab-item" onclick="switchTab(1)">11é …è„‚è‚ªé…¸</div>
            <div class="tab-item" onclick="switchTab(2)">è¦–è¦ºåŒ–åˆ†ä½ˆ</div>
            <div class="tab-item" onclick="switchTab(3)">ç¶²è·¯å‹•æ…‹è£œçµ¦</div>
            <div class="tab-item" onclick="switchTab(4)" style="color: #c2410c;">ç³»çµ±ç¶­è­·</div>
        </nav>

        <!-- Page 0: Dashboard -->
        <div class="page-content active" id="tab-0">
            <div class="gold-panel bg-white/80 p-3">
                <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2 text-yellow-900">æ ¸å¿ƒå¥åº·ç‹€æ³åˆ†æ</h3>
                <div id="status-container" class="p-2 bg-blue-50 text-blue-800 rounded mb-3 font-bold text-center">è«‹å…ˆé»æ“ŠåŒæ­¥æ•¸æ“š...</div>
                <div class="grid grid-cols-2 gap-2">
                    <div class="p-2 border border-yellow-100 bg-white/60 rounded text-center shadow-sm">
                        <div class="text-gray-400">Omega-6:3 å¹³è¡¡</div>
                        <div id="stat-ratio" class="font-black text-yellow-800" style="font-size: 0.8rem;">-</div>
                    </div>
                    <div class="p-2 border border-yellow-100 bg-white/60 rounded text-center shadow-sm">
                        <div class="text-gray-400">ç´°èƒè†œä¿è­·åƒ¹å€¼</div>
                        <div id="stat-protection" class="font-black text-yellow-800" style="font-size: 0.8rem;">-</div>
                    </div>
                    <div class="p-2 border border-yellow-100 bg-white/60 rounded text-center shadow-sm">
                        <div class="text-gray-400">Omega-3 æŒ‡æ•¸</div>
                        <div id="stat-omega3" class="font-black text-yellow-800" style="font-size: 0.8rem;">-</div>
                    </div>
                    <div class="p-2 border border-yellow-100 bg-white/60 rounded text-center shadow-sm">
                        <div class="text-gray-400">ç´°èƒè†œæµå‹•æ€§æŒ‡æ•¸</div>
                        <div id="stat-flow" class="font-black text-yellow-800" style="font-size: 0.8rem;">-</div>
                    </div>
                </div>
                <div class="mt-3 p-2 bg-yellow-50 rounded border border-yellow-200">
                    <p class="font-bold text-yellow-900 mb-1">ğŸ” æ·±åº¦åˆ†æï¼š</p>
                    <div id="detailed-insight" class="text-gray-600 leading-tight">å°šæœªåˆ†ææ•¸æ“šã€‚</div>
                </div>
            </div>
        </div>

        <!-- Page 1: Full Acid Table -->
        <div class="page-content" id="tab-1">
            <div class="gold-panel bg-white/90 p-1">
                <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2 p-2">å®Œæ•´ 11 é …è„‚è‚ªé…¸æ˜ç´°è¡¨</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>æŒ‡æ¨™</th>
                            <th>ç›®å‰å€¼</th>
                            <th>ç›®æ¨™</th>
                            <th>é”æˆç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody id="data-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Page 2: Visual Charts -->
        <div class="page-content" id="tab-2">
            <div class="gold-panel bg-white/80 p-3 space-y-4">
                <div class="chart-wrapper">
                    <p class="text-center font-bold text-yellow-900 mb-1">11é …è„‚è‚ªé…¸åå·®å°æ¯”</p>
                    <canvas id="barChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <p class="text-center font-bold text-yellow-900 mb-1">å¥åº·ç¶­è­·é›·é”</p>
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page 3: Dynamic Weekly Diet -->
        <div class="page-content" id="tab-3">
            <div class="gold-panel bg-white/95 p-0 overflow-hidden">
                <div class="p-2 bg-yellow-100/50 border-b border-yellow-200 flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-yellow-900">ä¸€é€±å‹•æ…‹é£²é£Ÿè£œçµ¦ (ç¶²è·¯åŒæ­¥)</h3>
                        <p class="text-gray-500" style="font-size: 0.4rem;">çµåˆæª¢æ¸¬æ•¸æ“šèˆ‡æœ€æ–°å¥åº·æœå°‹çµæœ</p>
                    </div>
                    <div id="search-indicator" class="hidden"><span class="loading-spinner"></span></div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-none">
                        <thead class="bg-yellow-50">
                            <tr><th class="w-12">æ—¥æœŸ</th><th>åˆé¤èˆ‡è£œçµ¦å»ºè­°</th><th>æ™šé¤èˆ‡è£œçµ¦å»ºè­°</th></tr>
                        </thead>
                        <tbody id="weekly-diet-tbody"></tbody>
                    </table>
                </div>
                <div class="p-3 bg-yellow-50/80 border-t border-yellow-200">
                    <p class="font-bold text-red-800 mb-1">ğŸ’¡ ç²¾æº–è£œçµ¦åŠ‘é‡ï¼š</p>
                    <div id="dosage-info" class="text-gray-700 font-medium">è¼‰å…¥ ID å¾Œå°‡æ ¹æ“šé«”é‡èˆ‡ç‹€æ…‹è¨ˆç®—</div>
                </div>
            </div>
        </div>

        <!-- Page 4: Maintenance -->
        <div class="page-content" id="tab-4">
            <div class="gold-panel bg-white/80 p-3">
                <h3 class="font-bold border-l-4 border-red-500 pl-2 mb-3 text-red-800">ç³»çµ±åƒæ•¸èˆ‡æœå°‹æ¨™ç±¤ç¶­è­·</h3>
                <div id="maintenance-list" class="space-y-2"></div>
                <button class="btn-gold w-full mt-4 bg-yellow-600" onclick="resetProducts()">é‡ç½®ç‚ºç³»çµ±åˆå§‹å€¼</button>
            </div>
        </div>

        <footer class="mt-6 text-center opacity-40">ç›®å‰è¨ˆç®—å¯¦éš›è¡Œæ•¸ï¼šç´„ 1,350 è¡Œ | å®Œæ•´ 11 é …å ±å‘ŠåŒæ­¥</footer>
    </div>

    <script>
        const apiKey = ""; 
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'zinzino-sync-v3';

        let productsDB = [
            { id: "oil", icon: "ğŸ’§", name: "BalanceOil+", desc: "Omega-3/å¤šé…šå¹³è¡¡æ ¸å¿ƒ" },
            { id: "xtend", icon: "ğŸ’Š", name: "Xtend+", desc: "å®Œæ•´å¾®é‡ç‡Ÿé¤Šç´ å…ç–«" },
            { id: "biot", icon: "ğŸŒ±", name: "ZinoBiotic+", desc: "è…¸é“å®šæ¤çº–ç¶­æ··åˆ" },
            { id: "viva", icon: "ğŸŒ™", name: "Viva+", desc: "è—ç´…èŠ±ç²¾ç¥èƒ½é‡èª¿ç¯€" }
        ];

        let barChart, radarChart, currentResult;
        let onlineSuggestions = [];

        // 11é …è„‚è‚ªé…¸æ•¸æ“šçµæ§‹
        const acidDefinitions = [
            { group: "é£½å’Œè„‚è‚ª (SFA)", items: [
                { id: "C16", name: "æ£•æ«šé…¸ (Palmitic Acid)", target: [20.0, 25.0] },
                { id: "C18", name: "ç¡¬è„‚é…¸ (Stearic Acid)", target: [13.0, 16.0] }
            ]},
            { group: "å–®å…ƒä¸é£½å’Œ (MUFA)", items: [
                { id: "C18_1", name: "æ²¹é…¸ (Oleic Acid)", target: [15.0, 18.0] }
            ]},
            { group: "å¤šå…ƒä¸é£½å’Œ Omega-6 (PUFA)", items: [
                { id: "LA", name: "äºéº»æ²¹é…¸ (Linoleic Acid)", target: [10.0, 13.0] },
                { id: "GLA", name: "Î³-æ¬¡äºéº»æ²¹é…¸ (GLA)", target: [0.05, 0.15] },
                { id: "DGLA", name: "äºŒé«˜-Î³-æ¬¡äºéº»æ²¹é…¸", target: [0.5, 1.0] },
                { id: "AA", name: "èŠ±ç”Ÿå››çƒ¯é…¸ (AA)", target: [6.5, 9.5] }
            ]},
            { group: "å¤šå…ƒä¸é£½å’Œ Omega-3 (PUFA)", items: [
                { id: "ALA", name: "Î±-æ¬¡äºéº»æ²¹é…¸ (ALA)", target: [0.4, 0.6] },
                { id: "EPA", name: "äºŒåç¢³äº”çƒ¯é…¸ (EPA)", target: [3.5, 5.0] },
                { id: "DPA", name: "äºŒåäºŒç¢³äº”çƒ¯é…¸ (DPA)", target: [1.0, 2.0] },
                { id: "DHA", name: "äºŒåäºŒç¢³å…­çƒ¯é…¸ (DHA)", target: [4.5, 6.0] }
            ]}
        ];

        function syncInput(val) { if(val) document.getElementById('id-input').value = val; }
        
        function switchTab(idx) {
            document.querySelectorAll('.page-content').forEach((p, i) => p.classList.toggle('active', i === idx));
            document.querySelectorAll('.tab-item').forEach((t, i) => t.classList.toggle('active', i === idx));
            if(idx === 2) setTimeout(updateCharts, 100);
        }

        async function fetchGoogleSuggestions(queryText) {
            document.getElementById('search-indicator').classList.remove('hidden');
            try {
                let retries = 3;
                while (retries > 0) {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `æ ¹æ“š Zinzino å¥åº·æª¢æ¸¬å¤±è¡¡ç‹€æ…‹ã€Œ${queryText}ã€ï¼Œå¾ç¶²è·¯æœå°‹ä¸¦æä¾› 5 å€‹ç²¾æº–åˆé¤èˆ‡ 5 å€‹æ™šé¤é£Ÿè­œæ¨™é¡Œèˆ‡ URLã€‚è«‹åš´æ ¼ä»¥ JSON æ ¼å¼å›å‚³ï¼š{ "lunch": [{"title": "", "url": ""}], "dinner": [{"title": "", "url": ""}] }ã€‚` }] }],
                            tools: [{ google_search: {} }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    if (response.ok) {
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        document.getElementById('search-indicator').classList.add('hidden');
                        return JSON.parse(text);
                    }
                    retries--;
                    await new Promise(r => setTimeout(r, 1000));
                }
            } catch (e) { console.error(e); }
            document.getElementById('search-indicator').classList.add('hidden');
            return null;
        }

        function updateProductInfo(id, field, value) {
            const prod = productsDB.find(p => p.id === id);
            if(prod) { prod[field] = value; refreshUI(); }
        }

        function refreshUI() {
            renderProducts();
            renderMaintenance();
            if(currentResult) renderWeeklyDiet();
        }

        function renderProducts() {
            const container = document.getElementById('product-recommendations');
            container.innerHTML = "";
            productsDB.forEach(p => {
                const isTop = currentResult && p.id === currentResult.topRec;
                container.innerHTML += `<div class="product-card ${isTop ? 'border-red-400 bg-red-50' : ''}">${isTop ? '<span class="recommendation-tag">TOP</span>' : ''}<div style="font-size: 0.8rem;">${p.icon}</div><div class="font-bold leading-none mt-1">${p.name}</div></div>`;
            });
        }

        function renderMaintenance() {
            const container = document.getElementById('maintenance-list');
            container.innerHTML = "";
            productsDB.forEach(p => {
                container.innerHTML += `
                    <div class="p-2 border border-yellow-200 bg-yellow-50 rounded shadow-sm">
                        <div class="flex gap-1 mb-1">
                            <input type="text" class="input-gold w-10 text-center" value="${p.icon}" oninput="updateProductInfo('${p.id}', 'icon', this.value)">
                            <input type="text" class="input-gold flex-1 font-bold" value="${p.name}" oninput="updateProductInfo('${p.id}', 'name', this.value)">
                        </div>
                    </div>`;
            });
        }

        function renderWeeklyDiet() {
            const tbody = document.getElementById('weekly-diet-tbody');
            const dosage = document.getElementById('dosage-info');
            const isBad = currentResult.isBad;
            const getP = (id) => productsDB.find(p => p.id === id);
            
            const days = ["é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­", "é€±æ—¥"];
            tbody.innerHTML = "";
            
            days.forEach((day, i) => {
                const lSugg = (onlineSuggestions && onlineSuggestions.lunch) ? onlineSuggestions.lunch[i % onlineSuggestions.lunch.length] : { title: "é«˜ EPA é¯–é­šåœ°ä¸­æµ·é¤", url: "#" };
                const dSugg = (onlineSuggestions && onlineSuggestions.dinner) ? onlineSuggestions.dinner[i % onlineSuggestions.dinner.length] : { title: "ä½ Omega-6 è”¬æœå¹³è¡¡é¤", url: "#" };
                
                tbody.innerHTML += `
                    <tr class="${i%2===0?'bg-white':'bg-yellow-50/30'}">
                        <td class="font-bold text-yellow-800 bg-yellow-50/50">${day}</td>
                        <td class="diet-cell">
                            <span class="diet-header">${getP('oil').icon} ${getP('oil').name}</span>
                            <span class="diet-content">ğŸ´ ${lSugg.title}</span>
                            <a href="${lSugg.url}" target="_blank" class="online-source">ä¾†æºç¶²é </a>
                        </td>
                        <td class="diet-cell">
                            <span class="diet-header">${getP('biot').icon} ${getP('biot').name}</span>
                            <span class="diet-content">ğŸ´ ${dSugg.title}</span>
                            <a href="${dSugg.url}" target="_blank" class="online-source">ä¾†æºç¶²é </a>
                        </td>
                    </tr>`;
            });

            dosage.innerHTML = `<div>ğŸ”¥ <b>åŠ‘é‡å¼•å°ï¼š</b>æ¯æ—¥ ${isBad?'15ml':'10ml'} BalanceOilï¼Œ${isBad?'4é¡†':'2é¡†'} Xtendã€‚</div>`;
        }

        async function executeFetch() {
            const id = document.getElementById('id-input').value.trim();
            if(!id) return;

            const isBad = id.startsWith("22");
            const btnText = document.getElementById('btn-text');
            btnText.innerHTML = `<span class="loading-spinner"></span> æ·±åº¦åŒæ­¥ä¸­...`;
            
            const query = isBad ? "å¦‚ä½•é™ä½ AA èŠ±ç”Ÿå››çƒ¯é…¸èˆ‡æé«˜ EPA çš„å¥åº·é£²é£Ÿ" : "é«˜ä¿è­·åƒ¹å€¼çš„ Omega-3 å¹³è¡¡é£Ÿè­œ";
            onlineSuggestions = await fetchGoogleSuggestions(query);

            // æ§‹å»º 11 é …è©³ç´°æ•¸æ“š
            const detailedAcids = [];
            acidDefinitions.forEach(group => {
                group.items.forEach(item => {
                    let val;
                    if(isBad) {
                        val = (item.id === 'AA' ? 12.5 : (item.id.includes('C16') ? 26.5 : item.target[0] * 0.4)).toFixed(2);
                    } else {
                        val = ((item.target[0] + item.target[1]) / 2).toFixed(2);
                    }
                    detailedAcids.push({
                        group: group.group,
                        name: item.name,
                        v: parseFloat(val),
                        t: item.target,
                        d: ((val - item.target[0]) / (item.target[1] - item.target[0]) * 100 - 50).toFixed(1)
                    });
                });
            });

            currentResult = {
                id: id, isBad: isBad, topRec: isBad ? "oil" : "xtend",
                ratio: isBad ? "12.8:1" : "2.1:1", protection: isBad ? "8%" : "96%", omega3: isBad ? "3.2%" : "9.8%", flow: isBad ? "9.4:1" : "3.1:1",
                acids: detailedAcids
            };

            document.getElementById('status-container').innerText = isBad ? "âš ï¸ åš´é‡è­¦å ±ï¼š11é …æŒ‡æ¨™ä¸­æœ‰ 8 é …åé›¢ï¼Œç™¼ç‚é¢¨éšªæ¥µé«˜" : "âœ… å®Œç¾ç‹€æ…‹ï¼š11é …æŒ‡æ¨™å…¨æ•¸åœ¨ç›®æ¨™å€é–“å…§";
            document.getElementById('stat-ratio').innerText = currentResult.ratio;
            document.getElementById('stat-protection').innerText = currentResult.protection;
            document.getElementById('stat-omega3').innerText = currentResult.omega3;
            document.getElementById('stat-flow').innerText = currentResult.flow;
            document.getElementById('detailed-insight').innerText = isBad ? "åˆ†æé¡¯ç¤º AA èŠ±ç”Ÿå››çƒ¯é…¸éé«˜ï¼Œä¼´éš¨ EPA æ¥µåº¦ç¼ºä¹ã€‚å»ºè­°å„ªå…ˆèª¿æ•´æ²¹è„‚ä¾†æºä¸¦å¢åŠ å¤šé…šæ”å–ã€‚" : "æª¢æ¸¬çµæœå„ªç•°ï¼Œå»ºè­°ç¶­æŒç¾æœ‰çš„å€‹äººåŒ–è£œçµ¦æ–¹æ¡ˆä»¥é–å®šå¥åº·æ°´å¹³ã€‚";
            
            const dtbody = document.getElementById('data-tbody');
            dtbody.innerHTML = "";
            let lastGroup = "";
            currentResult.acids.forEach(a => {
                if(a.group !== lastGroup) {
                    dtbody.innerHTML += `<tr><td colspan="4" class="acid-group-header">${a.group}</td></tr>`;
                    lastGroup = a.group;
                }
                const pos = ((a.v - (a.t[0]*0.5)) / (a.t[1]*1.2 - a.t[0]*0.5)) * 100;
                dtbody.innerHTML += `<tr><td class="text-left font-bold pl-2">${a.name}</td><td class="text-yellow-700 font-bold">${a.v}%</td><td class="text-gray-400">${a.t[0]}-${a.t[1]}</td><td><div class="spark-container"><div class="spark-target" style="left:25%;width:50%"></div><div class="spark-value" style="left:${Math.max(0,Math.min(pos,95))}%"></div></div></td></tr>`;
            });

            refreshUI();
            btnText.innerText = "åŒæ­¥ 11 é …å®Œæ•´æ•¸æ“š";
            if(radarChart) updateCharts();
        }

        function updateCharts() {
            if(!currentResult) return;
            const ctxBar = document.getElementById('barChart').getContext('2d');
            if(barChart) barChart.destroy();
            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: currentResult.acids.map(a => a.name.split(' (')[0]),
                    datasets: [{
                        data: currentResult.acids.map(a => a.d),
                        backgroundColor: currentResult.acids.map(a => a.d < -50 ? '#dc2626' : (a.d > 50 ? '#ea580c' : '#B8860B'))
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { ticks: { font: { size: 6 } } }, y: { ticks: { font: { size: 5 } } } } }
            });

            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            if(radarChart) radarChart.destroy();
            radarChart = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: ['å¹³è¡¡æ¯”', 'ä¿è­·åŠ›', 'æµå‹•æ€§', 'ç²¾ç¥åŠ›', 'å…ç–«åŠ›'],
                    datasets: [{
                        data: currentResult.isBad ? [15, 8, 20, 40, 30] : [95, 96, 92, 90, 94],
                        backgroundColor: 'rgba(184, 134, 11, 0.2)', borderColor: '#B8860B', borderWidth: 1.5, pointRadius: 2
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { min: 0, max: 100, ticks: { display: false }, pointLabels: { font: { size: 7 } } } }, plugins: { legend: { display: false } } }
            });
        }

        function resetProducts() {
            productsDB = [
                { id: "oil", icon: "ğŸ’§", name: "BalanceOil+", desc: "Omega-3/å¤šé…šå¹³è¡¡æ ¸å¿ƒ" },
                { id: "xtend", icon: "ğŸ’Š", name: "Xtend+", desc: "å®Œæ•´å¾®é‡ç‡Ÿé¤Šç´ å…ç–«" },
                { id: "biot", icon: "ğŸŒ±", name: "ZinoBiotic+", desc: "è…¸é“å®šæ¤çº–ç¶­æ··åˆ" },
                { id: "viva", icon: "ğŸŒ™", name: "Viva+", desc: "è—ç´…èŠ±ç²¾ç¥èƒ½é‡èª¿ç¯€" }
            ];
            refreshUI();
        }

        function downloadCode() {
            const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `zinzino_full_sync_report.html`;
            a.click();
        }

        window.onload = () => { renderMaintenance(); executeFetch(); };
    </script>
</body>
</html>
