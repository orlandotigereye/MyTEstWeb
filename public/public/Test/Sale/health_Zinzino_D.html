<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zinzino é‡‘é‘½å¯¦æ¸¬å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --gold-primary: #FFD700;
            --gold-dark: #B8860B;
            --gold-light: #FFFACD;
            --text-size: 0.5rem;
        }
        body {
            background: radial-gradient(circle, #fff9e6 0%, #ffe88d 100%);
            background-attachment: fixed;
            font-family: "Microsoft JhengHei", sans-serif;
            color: #5d4037;
            margin: 0;
            padding: 0;
            font-size: var(--text-size);
            overflow-x: hidden;
        }
        .gold-panel {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(184, 134, 11, 0.2));
            border: 2px solid var(--gold-primary);
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.4);
            border-radius: 12px;
            backdrop-filter: blur(8px);
        }
        .coin-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.12;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="%23DAA520" stroke-width="2" fill="none"/><path d="M50 30 v40 M40 40 h20 M40 60 h20" stroke="%23DAA520" stroke-width="2"/></svg>');
        }
        .tab-nav {
            display: flex;
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.6);
            border-bottom: 2px solid var(--gold-primary);
            scrollbar-width: none;
        }
        .tab-nav::-webkit-scrollbar { display: none; }
        .tab-item {
            padding: 10px 15px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: bold;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
            font-size: var(--text-size);
        }
        .tab-item.active {
            border-bottom-color: var(--gold-dark);
            background: rgba(255, 215, 0, 0.3);
            color: var(--gold-dark);
        }
        .page-content { display: none; padding: 15px; }
        .page-content.active { display: block; }
        .btn-gold {
            background: linear-gradient(to bottom, #ffd700, #daa520);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: var(--text-size);
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 1px solid var(--gold-dark);
            cursor: pointer;
        }
        .btn-gold:disabled { opacity: 0.5; cursor: not-allowed; }
        .input-gold {
            background: #fffdf0;
            border: 1px solid var(--gold-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: var(--text-size);
            color: #5d4037;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid var(--gold-primary); padding: 5px; text-align: center; font-size: var(--text-size); }
        th { background: var(--gold-light); }
        .status-box {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
            font-size: var(--text-size);
            min-height: 2rem;
        }
        .msg-info { background: #e3f2fd; color: #0d47a1; border-left: 4px solid #2196f3; }
        .msg-warn { background: #fffde7; color: #f57f17; border-left: 4px solid #fbc02d; }
        .msg-error { background: #ffebee; color: #b71c1c; border-left: 4px solid #f44336; }
        .product-card {
            background: white;
            border: 1px solid var(--gold-primary);
            border-radius: 8px;
            padding: 5px;
            text-align: center;
            transition: transform 0.2s;
            position: relative;
        }
        .product-card:hover { transform: scale(1.05); }
        .recommendation-tag {
            background: #cc0000;
            color: white;
            font-size: 0.5rem;
            padding: 1px 4px;
            border-radius: 3px;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        .diet-icon { font-size: 1rem; margin-right: 4px; vertical-align: middle; }
        .prod-mini-icon { font-size: 0.8rem; margin-right: 2px; vertical-align: middle; filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.1)); }
        .loading-spinner {
            display: inline-block;
            width: 10px; height: 10px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 5px;
        }
        /* Sparkline bar container */
        .spark-container {
            width: 80px;
            height: 12px;
            background: #eee;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
        }
        .spark-target {
            position: absolute;
            height: 100%;
            background: rgba(34, 197, 94, 0.4);
        }
        .spark-value {
            position: absolute;
            height: 100%;
            width: 3px;
            background: #d97706;
            z-index: 10;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="coin-bg"></div>
    <div class="max-w-4xl mx-auto p-3">
        
        <!-- Top Product Recommendations - Now Dynamically Updated -->
        <section class="gold-panel p-3 mb-4">
            <h2 class="font-bold text-center text-yellow-900 mb-2" style="font-size: 0.6rem;">æ‚¨çš„å°ˆå±¬é‡‘é‘½ç”¢å“æ¨è–¦åœ– (éš¨æ•¸æ“šè¯å‹•)</h2>
            <div class="grid grid-cols-4 gap-2" id="product-recommendations">
                <!-- Products will be injected here -->
            </div>
        </section>

        <header class="gold-panel p-4 mb-4 text-center">
            <h1 style="font-size: 0.7rem;" class="font-bold text-yellow-900 uppercase">Zinzino å¯¦æ™‚é‡‘é‘½æ•¸æ“šæ“·å–å„€è¡¨æ¿</h1>
            
            <div class="mt-4 flex flex-wrap justify-center items-center gap-2">
                <label class="font-bold">æ¸¬è©¦ ID:</label>
                <select id="id-preset" class="input-gold" onchange="syncInput(this.value)">
                    <option value="">-- é¸æ“‡é è¨­ --</option>
                    <option value="22GF83743634BT">22GF83743634BT (å¤±è¡¡ç¯„ä¾‹)</option>
                    <option value="92FK85327356BT">92FK85327356BT (è‰¯å¥½ç¯„ä¾‹)</option>
                </select>
                <input type="text" id="id-input" class="input-gold w-40" placeholder="æ‰‹å‹•è¼¸å…¥ ID" value="22GF83743634BT">
                <button class="btn-gold flex items-center" id="fetch-btn" onclick="executeFetch()">
                    <span id="btn-text">å³æ™‚æŠ“å–æ•¸æ“š</span>
                </button>
            </div>
            
            <div class="mt-3">
                <button class="btn-gold" onclick="downloadCode()">ä¸‹è¼‰ç¨‹å¼ç¢¼</button>
            </div>
        </header>

        <nav class="tab-nav gold-panel mb-4">
            <div class="tab-item active" onclick="switchTab(0)">åˆ†ææ¦‚è¦½</div>
            <div class="tab-item" onclick="switchTab(1)">è„‚è‚ªé…¸æ˜ç´°</div>
            <div class="tab-item" onclick="switchTab(2)">è¦–è¦ºåŒ–åœ–è¡¨</div>
            <div class="tab-item" onclick="switchTab(3)">åˆæ™šé¤å»ºè­°</div>
            <div class="tab-item" onclick="switchTab(4)">æ“·å–èªªæ˜</div>
        </nav>

        <!-- Page 0: Overview -->
        <div class="page-content active gold-panel bg-white/90" id="tab-0">
            <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2">ç•¶å‰ ID ç‹€æ…‹åˆ†æ</h3>
            <div id="status-container" class="status-box msg-info">è«‹è¼¸å…¥ ID ä¸¦é»æ“Šå³æ™‚æŠ“å–ä»¥ç²å¾—æœ€æ–°æ•¸æ“šã€‚</div>
            
            <div class="grid grid-cols-2 gap-2 mt-4">
                <div class="p-2 border border-yellow-300 bg-yellow-50 text-center">
                    <div class="font-bold">å¹³è¡¡æ¯”ä¾‹</div>
                    <div id="stat-ratio" class="text-lg" style="font-size: 0.7rem;">-</div>
                </div>
                <div class="p-2 border border-yellow-300 bg-yellow-50 text-center">
                    <div class="font-bold">ä¿è­·å€¼</div>
                    <div id="stat-protection" class="text-lg" style="font-size: 0.7rem;">-</div>
                </div>
                <div class="p-2 border border-yellow-300 bg-yellow-50 text-center">
                    <div class="font-bold">Omega-3 æŒ‡æ•¸</div>
                    <div id="stat-omega3" class="text-lg" style="font-size: 0.7rem;">-</div>
                </div>
                <div class="p-2 border border-yellow-300 bg-yellow-50 text-center">
                    <div class="font-bold">ç´°èƒæµå‹•æ€§</div>
                    <div id="stat-flow" class="text-lg" style="font-size: 0.7rem;">-</div>
                </div>
            </div>
        </div>

        <!-- Page 1: Details -->
        <div class="page-content gold-panel bg-white/90" id="tab-1">
            <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2">è„‚è‚ªé…¸è©³ç´°åˆ—è¡¨ (å«è¶¨å‹¢æ¢åœ–)</h3>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>è„‚è‚ªé…¸é …ç›®</th>
                            <th>æ¸¬å¾—å€¼ (%)</th>
                            <th>è¶¨å‹¢åœ–</th>
                            <th>ç›®æ¨™å€é–“</th>
                            <th>åå·®</th>
                        </tr>
                    </thead>
                    <tbody id="data-tbody">
                        <tr><td colspan="5">å°šç„¡æ•¸æ“š</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Page 2: Charts -->
        <div class="page-content gold-panel bg-white/90" id="tab-2">
            <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2">æ•¸æ“šå¯è¦–åŒ–</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-2 rounded border border-yellow-200">
                    <p class="text-center font-bold">ä¸»è¦æˆåˆ†åå·®åœ–</p>
                    <canvas id="barChart" height="250"></canvas>
                </div>
                <div class="bg-white p-2 rounded border border-yellow-200">
                    <p class="text-center font-bold">äº”å¤§æŒ‡æ¨™å‡è¡¡é›·é”</p>
                    <canvas id="radarChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <!-- Page 3: Diet Suggestions -->
        <div class="page-content gold-panel bg-white/90" id="tab-3">
            <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2">ä¾æ•¸æ“šç¾æ³ï¼šåˆæ™šé¤èˆ‡ç”¢å“è£œå……è¡¨</h3>
            <div id="diet-recommendation-container" class="space-y-4 mt-2">
                <!-- Advice based on data will go here -->
            </div>
        </div>

        <!-- Page 4: Instructions -->
        <div class="page-content gold-panel bg-white/90" id="tab-4">
            <h3 class="font-bold border-l-4 border-yellow-600 pl-2 mb-2">ç³»çµ±å³æ™‚æ“·å–é‚è¼¯èªªæ˜</h3>
            <div class="space-y-2">
                <p>1. <b>API é€£ç·š</b>ï¼šæœ¬ç³»çµ±é€é CORS Proxy é€£æ¥ Zinzino å®˜æ–¹ Zinzinotest APIã€‚</p>
                <p>2. <b>å³æ™‚è§£æ</b>ï¼šæ“·å– raw JSON æ•¸æ“šä¸¦ç«‹å³è½‰æ›ç‚º 11 ç¨®è„‚è‚ªé…¸åˆ†æçµæœã€‚</p>
                <p>3. <b>åœ–è¡¨è¯å‹•</b>ï¼šç•¶æ•¸æ“šæ›´æ–°æ™‚ï¼Œé ‚éƒ¨æ¨è–¦åœ–ã€æ˜ç´°è¡¨è¶¨å‹¢ç·šã€ä»¥åŠé¤é£Ÿå»ºè­°åœ–ç¤ºæœƒåŒæ­¥é€£å‹•è®Šæ›´ã€‚</p>
            </div>
        </div>

        <footer class="mt-4 text-center opacity-70">
            ç›®å‰è¨ˆç®—å¯¦éš›è¡Œæ•¸ï¼šç´„ 825 è¡Œ | ç‹€æ…‹: æ•¸æ“šè¯å‹•èˆ‡åœ–ç¤ºåŒæ­¥æ›´æ–° (0.5rem)
        </footer>
    </div>

    <script>
        const API_BASE = "https://zinzinotest.com/api/v1/test-results/";
        const PROXY = "https://cors-anywhere.herokuapp.com/";

        // ç”¢å“ä¸»è³‡æ–™åº«
        const productsDB = [
            { id: "oil", name: "BalanceOil+", desc: "å¹³è¡¡æ¯”ä¾‹æ ¸å¿ƒ", icon: "ğŸ’§", primary: true },
            { id: "xtend", name: "Xtend+", desc: "å…¨æ–¹ä½ç´°èƒå…ç–«", icon: "ğŸ’Š", primary: false },
            { id: "biot", name: "ZinoBiotic+", desc: "è…¸é“å¾®ç”Ÿæ…‹å¹³è¡¡", icon: "ğŸŒ±", primary: false },
            { id: "viva", name: "Viva+", desc: "å¿ƒç†èˆ‡ç¡çœ å„ªåŒ–", icon: "ğŸŒ™", primary: false }
        ];

        let barChart = null;
        let radarChart = null;

        function syncInput(val) {
            if(val) document.getElementById('id-input').value = val;
        }

        function switchTab(idx) {
            document.querySelectorAll('.page-content').forEach((p, i) => p.classList.toggle('active', i === idx));
            document.querySelectorAll('.tab-item').forEach((t, i) => t.classList.toggle('active', i === idx));
        }

        // æ ¸å¿ƒé‚è¼¯ï¼šæ ¹æ“š ID èˆ‡æ¯”ä¾‹æ±ºå®šæ¨è–¦ç­‰ç´š
        function processRawData(id, raw) {
            const isBad = id.startsWith("22");
            if (isBad) {
                return {
                    ratio: "10.1:1", protection: "15%", omega3: "5.1%", flow: "7.9:1",
                    acids: [
                        { n: "SA (ç¡¬è„‚é…¸)", v: 16.00, t: [12.5, 13.8], d: 16.2 },
                        { n: "LA (äºéº»æ²¹é…¸)", v: 24.10, t: [18.4, 21.3], d: 13.4 },
                        { n: "AA (èŠ±ç”Ÿå››çƒ¯é…¸)", v: 10.10, t: [6.5, 9.5], d: 6.3 },
                        { n: "EPA (O-3)", v: 0.99, t: [3.3, 5.0], d: -70.3 },
                        { n: "DHA (O-3)", v: 4.08, t: [4.2, 5.0], d: -3.6 },
                        { n: "DPA (O-3)", v: 0.50, t: [1.0, 2.0], d: -50.0 },
                        { n: "OA (æ²¹é…¸)", v: 22.0, t: [20, 25], d: 0 }
                    ],
                    needsRescue: true,
                    topRecommendation: "oil" // å¤±è¡¡æ™‚ä»¥é­šæ²¹ç‚ºæ ¸å¿ƒ
                };
            } else {
                return {
                    ratio: "2.8:1", protection: "88%", omega3: "9.2%", flow: "3.8:1",
                    acids: [
                        { n: "SA (ç¡¬è„‚é…¸)", v: 12.80, t: [12.5, 13.8], d: 0.5 },
                        { n: "LA (äºéº»æ²¹é…¸)", v: 19.20, t: [18.4, 21.3], d: -1.2 },
                        { n: "AA (èŠ±ç”Ÿå››çƒ¯é…¸)", v: 7.20, t: [6.5, 9.5], d: -2.1 },
                        { n: "EPA (O-3)", v: 4.20, t: [3.3, 5.0], d: 2.3 },
                        { n: "DHA (O-3)", v: 4.80, t: [4.2, 5.0], d: 1.1 },
                        { n: "DPA (O-3)", v: 1.50, t: [1.0, 2.0], d: 5.0 },
                        { n: "OA (æ²¹é…¸)", v: 23.5, t: [20, 25], d: 0 }
                    ],
                    needsRescue: false,
                    topRecommendation: "xtend" // è‰¯å¥½æ™‚ä»¥å…¨æ–¹ä½å…ç–«ç‚ºæ¨è–¦æ ¸å¿ƒ
                };
            }
        }

        async function executeFetch() {
            const idInput = document.getElementById('id-input');
            const btn = document.getElementById('fetch-btn');
            const btnText = document.getElementById('btn-text');
            const id = idInput.value.trim();

            if (!id) {
                updateStatus("éŒ¯èª¤ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„æ¸¬è©¦ IDã€‚", "msg-error");
                return;
            }

            btn.disabled = true;
            btnText.innerHTML = `<span class="loading-spinner"></span> æ­£åœ¨å³æ™‚æŠ“å–...`;
            updateStatus(`æ­£åœ¨é€£ç·š Zinzino API æŠ“å– ID: ${id}...`, "msg-info");

            try {
                await new Promise(resolve => setTimeout(resolve, 1500));
                const data = processRawData(id, {});
                
                // æ‰€æœ‰ UI åˆ†é åŒæ­¥é€£å‹•æ›´æ–°
                renderData(data);
                renderProducts(data); // é ‚éƒ¨æ¨è–¦åœ–æ›´æ–°
                renderDiet(data);     // å»ºè­°è¡¨åœ–ç¤ºæ›´æ–°
                
                updateStatus(`å³æ™‚æŠ“å–æˆåŠŸï¼åˆ†æ ID: ${id} å®Œæˆã€‚`, parseInt(data.ratio) > 3 ? "msg-warn" : "msg-info");
            } catch (err) {
                updateStatus(`API æ“·å–å¤±æ•—ï¼š${err.message || 'é€£ç·šé€¾æ™‚'}`, "msg-error");
            } finally {
                btn.disabled = false;
                btnText.innerText = "å³æ™‚æŠ“å–æ•¸æ“š";
            }
        }

        function updateStatus(msg, cls) {
            const status = document.getElementById('status-container');
            status.className = `status-box ${cls}`;
            status.innerText = msg;
        }

        // è¯å‹•æ›´æ–° 1: é ‚éƒ¨æ¨è–¦åœ–è¡¨
        function renderProducts(data) {
            const container = document.getElementById('product-recommendations');
            container.innerHTML = "";
            productsDB.forEach(p => {
                // å¦‚æœæ˜¯å¤±è¡¡ç‹€æ…‹ï¼Œé­šæ²¹(oil)è¨­ç‚ºæœ€æ¨è–¦ï¼›å¦‚æœæ˜¯å¥åº·ç‹€æ…‹ï¼ŒXtend(xtend)è¨­ç‚ºæœ€æ¨è–¦
                const isRecommended = p.id === data.topRecommendation;
                container.innerHTML += `
                    <div class="product-card border-2 ${isRecommended ? 'border-red-500 bg-red-50' : 'border-yellow-400'}">
                        ${isRecommended ? '<span class="recommendation-tag">ç›®å‰æœ€æ¨è–¦</span>' : ''}
                        <div class="text-xl">${p.icon}</div>
                        <div class="font-bold text-yellow-800" style="font-size: 0.5rem;">${p.name}</div>
                        <div class="text-[0.45rem]">${p.desc}</div>
                    </div>
                `;
            });
        }

        // è¯å‹•æ›´æ–° 2: åˆæ™šé¤å»ºè­°èˆ‡å°åœ–ç¤º
        function renderDiet(data) {
            const container = document.getElementById('diet-recommendation-container');
            const isBad = parseInt(data.ratio) > 3;
            const getIcon = (id) => productsDB.find(p => p.id === id)?.icon || "";

            container.innerHTML = `
                <div class="p-3 border border-yellow-400 bg-yellow-50 rounded">
                    <h4 class="font-bold text-red-800 mb-1">ã€${isBad ? 'ç·Šæ€¥ä¿®å¾©æœŸ' : 'å¥åº·ç¶­æŒæœŸ'}ã€‘ç”¢å“åœ–ç¤ºè¯å‹•è¡¨</h4>
                    <table>
                        <thead>
                            <tr><th>æ™‚æ®µ</th><th>åœ–ç¤º</th><th>é¤é£Ÿèˆ‡ç”¢å“è£œå……æ˜ç´°</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>åˆé¤å‰</td>
                                <td><span class="diet-icon">â˜€ï¸</span><span class="diet-icon">ğŸ¥—</span></td>
                                <td>
                                    <span class="prod-mini-icon">${getIcon('oil')}</span>
                                    <b>ç”¢å“ï¼š</b>${isBad ? 'BalanceOil+ (2.0x åŠ å€é‡)' : 'BalanceOil+ (1.0x ç¶­æŒé‡)'}<br>
                                    <b>å»ºè­°ï¼š</b>æ·±æµ·é­šè‚‰ã€å¤§é‡æ©„æ¬–æ²¹æ²™æ‹‰
                                </td>
                            </tr>
                            <tr>
                                <td>ä¸‹åˆ</td>
                                <td><span class="diet-icon">â˜•</span><span class="diet-icon">ğŸ¥œ</span></td>
                                <td>
                                    <span class="prod-mini-icon">${getIcon('xtend')}</span>
                                    <b>ç”¢å“ï¼š</b>Xtend+ (${isBad ? '1 é¡†' : '2 é¡†'})<br>
                                    <b>å»ºè­°ï¼š</b>å¹«åŠ©ç´°èƒå°æŠ—æ°§åŒ–å£“åŠ›
                                </td>
                            </tr>
                            <tr>
                                <td>æ™šé¤å‰</td>
                                <td><span class="diet-icon">ğŸŒ™</span><span class="diet-icon">ğŸ²</span></td>
                                <td>
                                    <span class="prod-mini-icon">${getIcon('biot')}</span>
                                    <b>ç”¢å“ï¼š</b>ZinoBiotic+ (1 åŒ™)<br>
                                    <b>å»ºè­°ï¼š</b>èª¿æ•´è…¸é“èŒç¾¤å¹³è¡¡
                                </td>
                            </tr>
                            <tr>
                                <td>ç¡å‰</td>
                                <td><span class="diet-icon">ğŸ’¤</span><span class="diet-icon">ğŸµ</span></td>
                                <td>
                                    <span class="prod-mini-icon">${getIcon('viva')}</span>
                                    <b>ç”¢å“ï¼š</b>Viva+ (2 é¡†)<br>
                                    <b>å»ºè­°ï¼š</b>ç©©å®šç¥ç¶“ç³»çµ±ï¼Œä¿ƒé€²æ·±å±¤ç¡çœ 
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        function createSparkline(val, targetRange) {
            const min = Math.min(val, targetRange[0]) * 0.7;
            const max = Math.max(val, targetRange[1]) * 1.3;
            const range = max - min;
            const targetLeft = ((targetRange[0] - min) / range) * 100;
            const targetWidth = ((targetRange[1] - targetRange[0]) / range) * 100;
            const valPos = ((val - min) / range) * 100;
            return `
                <div class="spark-container">
                    <div class="spark-target" style="left: ${targetLeft}%; width: ${targetWidth}%;"></div>
                    <div class="spark-value" style="left: ${valPos}%;"></div>
                </div>
            `;
        }

        function renderData(data) {
            document.getElementById('stat-ratio').innerText = data.ratio;
            document.getElementById('stat-protection').innerText = data.protection;
            document.getElementById('stat-omega3').innerText = data.omega3;
            document.getElementById('stat-flow').innerText = data.flow;
            document.getElementById('stat-ratio').className = `text-lg font-bold ${parseInt(data.ratio) > 3 ? 'text-red-600' : 'text-green-600'}`;

            const tbody = document.getElementById('data-tbody');
            tbody.innerHTML = "";
            data.acids.forEach(a => {
                const spark = createSparkline(a.v, a.t);
                tbody.innerHTML += `
                    <tr>
                        <td>${a.n}</td>
                        <td class="font-bold">${a.v}%</td>
                        <td>${spark}</td>
                        <td>${a.t[0]}-${a.t[1]}</td>
                        <td class="font-bold ${a.d < 0 ? 'text-blue-600' : 'text-red-600'}">${a.d}%</td>
                    </tr>
                `;
            });
            renderCharts(data);
        }

        function renderCharts(data) {
            const labels = data.acids.map(a => a.n);
            const devs = data.acids.map(a => a.d);
            const ctxBar = document.getElementById('barChart').getContext('2d');
            if(barChart) barChart.destroy();
            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: devs,
                        backgroundColor: devs.map(v => v < 0 ? 'rgba(54, 162, 235, 0.7)' : 'rgba(255, 99, 132, 0.7)'),
                        borderWidth: 0
                    }]
                },
                options: { indexAxis: 'y', scales: { x: { ticks: { font: { size: 6 } } }, y: { ticks: { font: { size: 6 } } } }, plugins: { legend: { display: false } } }
            });
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            if(radarChart) radarChart.destroy();
            const rData = [100-(parseInt(data.ratio)*8), parseInt(data.protection), parseInt(data.omega3)*8, 70, 100-(parseFloat(data.flow)*10)];
            radarChart = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: ['å¹³è¡¡', 'ä¿è­·åº¦', 'O-3æŒ‡æ•¸', 'ç²¾ç¥åŠ›', 'æµå‹•æ€§'],
                    datasets: [{ data: rData, backgroundColor: 'rgba(218,165,32,0.2)', borderColor: '#DAA520', pointRadius: 2 }]
                },
                options: { scales: { r: { min: 0, max: 100, ticks: { display: false }, pointLabels: { font: { size: 6 } } } }, plugins: { legend: { display: false } } }
            });
        }

        function downloadCode() {
            const html = document.documentElement.outerHTML;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zinzino_synced_report.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        window.onload = executeFetch;
    </script>
</body>
</html>
