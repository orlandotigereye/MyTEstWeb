<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ” èº«åˆ†é©—è­‰ - Sale3 V3.2</title>
    
    <!-- Dynamic Pathing -->
    <script id="path-helper-loader">
        (function() {
            const paths = ['/01js/path_helper.js', '../../../01js/path_helper.js', '../../01js/path_helper.js', '../01js/path_helper.js'];
            let index = 0;
            function tryNext() {
                if (index >= paths.length) return;
                const script = document.createElement('script');
                script.src = paths[index];
                script.async = false;
                script.onerror = function() {
                    if (script.parentNode) document.head.removeChild(script);
                    index++;
                    tryNext();
                };
                script.onload = function() { console.log('Path Helper active: ' + paths[index]); };
                document.head.appendChild(script);
            }
            tryNext();
        })();
    </script>

    <!-- 1. CSS Layer -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
        .auth-card { max-width: 400px; margin: 20px auto; padding: 15px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 12px; }
        .link-btn { font-size: 11px; color: var(--accent-dark); cursor: pointer; text-decoration: underline; margin-top: 10px; display: inline-block; }
    </style>

    <!-- 2. Fixed Data Layer -->
    <script>
        const AUTH_CONFIG = {
            KEYS: { USERS: 'sale3_users', CURRENT: 'currentUser' }
        };
    </script>

    <!-- 3. Script Layer -->
    <script>
        async function checkDataInit() {
            if (!localStorage.getItem(AUTH_CONFIG.KEYS.USERS)) {
                const d = await fetch('../../Sale2/data/users.json').then(r => r.json()).catch(() => []);
                APP_CORE.saveLocal(AUTH_CONFIG.KEYS.USERS, d);
            }
        }

        function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const users = APP_CORE.getLocal(AUTH_CONFIG.KEYS.USERS);
            const user = users.find(x => x.username === u && x.password === p);
            
            if (user) {
                APP_CORE.saveLocal(AUTH_CONFIG.KEYS.CURRENT, user);
                APP_CORE.showToast('ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨å°å‘...');
                setTimeout(() => location.href = '../indexA.html', 800);
            } else {
                APP_CORE.showToast('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
            }
        }

        function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const u = document.getElementById('reg-username').value;
            const p = document.getElementById('reg-password').value;
            const role = document.getElementById('reg-role').value;

            if(!u || !p || !name) return APP_CORE.showToast('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');
            const users = APP_CORE.getLocal(AUTH_CONFIG.KEYS.USERS);
            if(users.find(x => x.username === u)) return APP_CORE.showToast('å¸³è™Ÿå·²å­˜åœ¨');

            users.push({ id: 'U' + Date.now(), username: u, password: p, name, role });
            APP_CORE.saveLocal(AUTH_CONFIG.KEYS.USERS, users);
            APP_CORE.showToast('è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥');
            switchTab('loginTab');
        }

        function submitForgot() {
            const u = document.getElementById('forgot-username').value;
            if(!u) return APP_CORE.showToast('è«‹è¼¸å…¥å¸³è™Ÿ');
            APP_CORE.showToast('é‡ç½®é€£çµå·²ç™¼é€ (æ¨¡æ“¬)');
            switchTab('loginTab');
        }

        window.addEventListener('coreReady', () => { checkDataInit(); });
    </script>
</head>
<body>
    <div class="tabs-container">
        <button class="tab-btn active" onclick="switchTab('loginTab')"><i class="fas fa-sign-in-alt"></i> æœƒå“¡ç™»å…¥</button>
        <button class="tab-btn" onclick="switchTab('registerTab')"><i class="fas fa-user-plus"></i> å¸³è™Ÿè¨»å†Š</button>
        <button class="tab-btn" onclick="location.href='../indexA.html'"><i class="fas fa-arrow-left"></i> è¿”å›</button>
    </div>

    <!-- Login Tab -->
    <div id="loginTab" class="content-section active">
        <div class="card auth-card">
            <h2>ğŸ” æœƒå“¡ç™»å…¥</h2>
            <div class="form-group"><label>å¸³è™Ÿ</label><input type="text" id="username" class="input-gold" value="user1"></div>
            <div class="form-group"><label>å¯†ç¢¼</label><input type="password" id="password" class="input-gold" value="password"></div>
            <button class="btn-gold" style="width: 100%" onclick="handleLogin()">ç™»å…¥</button>
            <div style="font-size:10px; color:#888; margin-top:15px; text-align:center; border-top:1px solid #eee; padding-top:10px;">
                æ¸¬è©¦æœƒå“¡ï¼šuser1 / password <br>
                æ¸¬è©¦ç‡Ÿé¤Šå¸«ï¼šrd1 / password
            </div>
            <span class="link-btn" onclick="switchTab('forgotTab')">å¿˜è¨˜å¯†ç¢¼ C1a</span>
        </div>
    </div>

    <!-- Register Tab -->
    <div id="registerTab" class="content-section">
        <div class="card auth-card">
            <h2>ğŸ” å¸³è™Ÿè¨»å†Š</h2>
            <div class="form-group"><label>çœŸå¯¦å§“å</label><input type="text" id="reg-name" class="input-gold"></div>
            <div class="form-group"><label>ç™»å…¥å¸³è™Ÿ</label><input type="text" id="reg-username" class="input-gold"></div>
            <div class="form-group"><label>è¨­å®šå¯†ç¢¼</label><input type="password" id="reg-password" class="input-gold"></div>
            <div class="form-group">
                <label>è§’è‰²é¸æ“‡</label>
                <select id="reg-role" class="input-gold" style="height:40px;">
                    <option value="user">ä¸€èˆ¬ä½¿ç”¨è€…</option>
                    <option value="admin">å…¬å¸ç®¡ç†å“¡</option>
                </select>
            </div>
            <button class="btn-gold" style="width: 100%" onclick="handleRegister()">å®Œæˆè¨»å†Š</button>
        </div>
    </div>

    <!-- Forgot Tab -->
    <div id="forgotTab" class="content-section">
        <div class="card auth-card">
            <h2>ğŸ” å¿˜è¨˜å¯†ç¢¼ C1a</h2>
            <div class="form-group">
                <label>è«‹è¼¸å…¥è¨»å†Šå¸³è™Ÿ</label>
                <input type="text" id="forgot-username" class="input-gold" placeholder="Username">
            </div>
            <button class="btn-gold" style="width: 100%" onclick="submitForgot()">ç™¼é€é‡ç½®ä¿¡</button>
            <span class="link-btn" onclick="switchTab('loginTab')">è¿”å›ç™»å…¥</span>
        </div>
    </div>
</body>
</html>