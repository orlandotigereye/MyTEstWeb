<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çš‡æ¥µç¶“ä¸–ãƒ»çš‡æ¥µæ„Ÿæ‡‰åœ–æ•¸æ¼”ç®—ç³»çµ±</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
:root {
    --gold-primary: #ffd700;
    --gold-dark: #b8860b;
    --gold-light: #fff9e6;
    --bg-gold: radial-gradient(circle, #fff8e1 0%, #ffd700 100%);
    --font-size: 0.5rem;
}

body {
    font-family: "PingFang TC", "STKaiti", serif;
    background: var(--bg-gold);
    background-attachment: fixed;
    color: #3e2723;
    margin: 0;
    padding: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
}

.container {
    width: 100%;
    max-width: 950px;
    background: rgba(255, 255, 255, 0.96);
    border: 3px double var(--gold-dark);
    border-radius: 15px;
    box-shadow: 0 15px 45px rgba(0,0,0,0.3);
    padding: 10px;
    box-sizing: border-box;
}

h1 {
    font-size: 1.1rem;
    text-align: center;
    color: var(--gold-dark);
    margin: 8px 0;
    text-shadow: 1px 1px 0px white;
}

.tiny-text {
    font-size: var(--font-size) !important;
    line-height: 1.4;
}

.tabs {
    display: flex;
    flex-wrap: wrap;
    border-bottom: 2px solid var(--gold-dark);
    margin-bottom: 8px;
}

.tab {
    flex: 1;
    min-width: 60px;
    padding: 6px;
    text-align: center;
    font-size: var(--font-size);
    cursor: pointer;
    background: #fdf5e6;
    border: 1px solid #ddd;
    border-bottom: none;
    transition: 0.3s;
}

.tab.active {
    background: var(--gold-dark);
    color: white;
    font-weight: bold;
}

.page {
    display: none;
}

.page.active {
    display: block;
    animation: fadeIn 0.4s;
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.card {
    background: #fff;
    border: 1px solid var(--gold-primary);
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 6px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
}

.input-section {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    justify-content: center;
}

input, button {
    font-size: var(--font-size);
    padding: 4px 8px;
    border: 1px solid var(--gold-dark);
    border-radius: 4px;
}

button {
    background: linear-gradient(to bottom, #ffd700, #b8860b);
    color: white;
    cursor: pointer;
    font-weight: bold;
}

.chart-svg {
    background: #fff;
    width: 100%;
    height: 280px;
    border: 1px solid #eee;
}

.hex-box {
    display: flex;
    flex-direction: column-reverse;
    width: 30px;
    height: 45px;
}

.yao {
    height: 5px;
    width: 100%;
    margin: 1px 0;
}
.yao.yang { background: #333; }
.yao.yin { background: linear-gradient(to right, #333 42%, transparent 42%, transparent 58%, #333 58%); }

.log-container {
    max-height: 400px;
    overflow-y: auto;
    background: #fcfcfc;
    border: 1px inset #eee;
    padding: 5px;
}

#download-btn {
    position: fixed;
    bottom: 15px;
    right: 15px;
    padding: 8px;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    font-size: 0.5rem;
    background: var(--gold-dark);
    color: white;
    border: 2px solid white;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 999;
}

.history-item {
    cursor: pointer;
    background: #eee;
    padding: 2px 5px;
    margin: 2px;
    display: inline-block;
    border-radius: 3px;
}

.formula-card {
    background: #fffde7;
    border-left: 4px solid var(--gold-dark);
    padding: 5px;
    margin: 5px 0;
}

.table-gz {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size);
}
.table-gz td {
    border: 1px solid #ddd;
    padding: 2px;
    text-align: center;
}
</style>
</head>
<body>

<div class="container">
    <h1>ğŸº çš‡æ¥µç¶“ä¸–ãƒ»çš‡æ¥µæ„Ÿæ‡‰åœ–æ•¸æ¼”ç®—ç³»çµ±</h1>

    <div class="card">
        <div class="input-section tiny-text">
            <span><b>è¼¸å…¥æ¨ç®—åŸºæ•¸ï¼š</b></span>
            <input id="mainInput" type="number" value="1011">
            <button onclick="runCalculation()">åŸ·è¡Œå…¨ç¯‡æ„Ÿæ‡‰æ¼”ç®—</button>
            <div id="examples">
                <b>ä¾‹ï¼š</b>
                <span class="history-item" onclick="setVal(1011)">é‚µé›(1011)</span>
                <span class="history-item" onclick="setVal(1037)">è˜‡è»¾(1037)</span>
                <span class="history-item" onclick="setVal(1563)">è¬æ›†(1563)</span>
                <span class="history-item" onclick="setVal(1945)">çµ‚æˆ°(1945)</span>
            </div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab(0)">12å·å…¨ç¯‡æ¨ç®—</div>
        <div class="tab" onclick="switchTab(1)">æ„Ÿæ‡‰å¹²æ¶‰åœ–</div>
        <div class="tab" onclick="switchTab(2)">è¡Œç‚ºå‰‡è§£æ</div>
        <div class="tab" onclick="switchTab(3)">ç®—æ³•ç†è©³è§£</div>
        <div class="tab" onclick="switchTab(4)">å…ƒæœƒæ¶æ§‹åœ–</div>
    </div>

    <!-- é é¢ 0: å…¨ç¯‡æ¨ç®— -->
    <div id="page0" class="page active">
        <div class="card">
            <div id="summary-info" class="tiny-text" style="color: var(--gold-dark); font-weight:bold; margin-bottom:10px;"></div>
            <div class="log-container" id="full-calc-log"></div>
        </div>
    </div>

    <!-- é é¢ 1: æ„Ÿæ‡‰å¹²æ¶‰åœ– -->
    <div id="page1" class="page">
        <div class="card">
            <div class="tiny-text" style="margin-bottom:5px;"><b>ã€çš‡æ¥µæ„Ÿæ‡‰ï¼šé«”ç”¨èƒ½é‡å¹²æ¶‰åˆ†æåœ–ã€‘</b> (åŸºæ–¼ $S(t)$ æ¨¡å‹)</div>
            <svg id="vibration-svg" class="chart-svg"></svg>
            <div id="graph-analysis" class="tiny-text" style="margin-top:8px;"></div>
        </div>
    </div>

    <!-- é é¢ 2: è¡Œç‚ºå»ºè­° -->
    <div id="page2" class="page">
        <div id="behavior-detail" class="tiny-text"></div>
    </div>

    <!-- é é¢ 3: ç®—æ³•ç†è©³è§£ (åŠ å¼·åœ–è¡¨èªªæ˜) -->
    <div id="page3" class="page">
        <div class="card tiny-text">
            <div class="formula-card">
                <b>æ•¸ç†æ¨¡å‹ï¼š$S(t) = \text{é«”} \cdot \cos(\frac{2\pi t}{12}) + \text{ç”¨} \cdot \sin(\frac{2\pi t}{30})$</b>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <div style="flex: 1; min-width: 300px;">
                    <p><b>1. é«”æ•¸åœ–è§£ (å…ˆå¤©å®šæ•¸)ï¼š</b> 
                    ä»¥ 12 ç‚ºé€±æœŸï¼Œè±¡å¾µåœ°åŸºèˆ‡æœ¬è³ªã€‚æ›²ç·šç©©å®šï¼Œæ±ºå®šé•·æœŸèµ°å‹¢ã€‚</p>
                    <svg id="body-chart" class="chart-svg" style="height: 120px;"></svg>
                </div>
                <div style="flex: 1; min-width: 300px;">
                    <p><b>2. ç”¨æ•¸åœ–è§£ (å¾Œå¤©è®Šé‡)ï¼š</b> 
                    ä»¥ 30 ç‚ºé€±æœŸï¼Œè±¡å¾µäººç‚ºã€ç’°å¢ƒèˆ‡ç´éŸ³æ¶ˆé•·ã€‚æ³¢å‹•è¼ƒé »ç¹ã€‚</p>
                    <svg id="use-chart" class="chart-svg" style="height: 120px;"></svg>
                </div>
            </div>
            <p><b>3. æ„Ÿæ‡‰ç–ŠåŠ ï¼š</b> å…©åœ–è¡¨ç–ŠåŠ å³ç”¢ç”Ÿé é¢äºŒä¹‹ã€Œå¹²æ¶‰åœ–ã€ã€‚è‹¥é«”ç”¨ç›¸ä½åŒå‘ï¼Œæ³¢å¹…æ“´å¤§ï¼Œæ„Ÿæ‡‰æœ€å¼·ã€‚</p>
        </div>
    </div>

    <!-- é é¢ 4: å…ƒæœƒæ¶æ§‹åœ– -->
    <div id="page4" class="page">
        <div class="card tiny-text">
            <p><b>ã€çš‡æ¥µç¶“ä¸–æ™‚é–“å–®ä½æ¶æ§‹è¡¨ã€‘</b></p>
            <table class="table-gz">
                <tr style="background:#f0f0f0; font-weight:bold;">
                    <td>å–®ä½</td><td>é€²ä½</td><td>å¹´æ•¸</td><td>æ„ç¾©</td>
                </tr>
                <tr><td>1 å…ƒ</td><td>12 æœƒ</td><td>129,600</td><td>ä¸€å…ƒå¾©å§‹</td></tr>
                <tr><td>1 æœƒ</td><td>30 é‹</td><td>10,800</td><td>å¤©åœ°è®Šé·</td></tr>
                <tr><td>1 é‹</td><td>12 ä¸–</td><td>360</td><td>æœä»£æ›´è¿­</td></tr>
                <tr><td>1 ä¸–</td><td>30 å¹´</td><td>30</td><td>ä¸€ä»£ä¹‹æ²»</td></tr>
            </table>
            <p style="margin-top:10px;"><b>ç•¶å‰åŸºæ•¸åœ¨å…­åç”²å­ä¸­ä¹‹åˆ†å¸ƒï¼š</b></p>
            <div id="gz-distribution" style="display:flex; flex-wrap:wrap; gap:2px;"></div>
        </div>
    </div>
</div>

<button id="download-btn" onclick="downloadLogic()">ä¸‹è¼‰ä»£ç¢¼</button>

<script>
/**
 * çš‡æ¥µç¶“ä¸–ãƒ»å®Œæ•´æ¼”ç®—é‚è¼¯
 */

const HEX_DATA = [
    { name: "å¾©", yao: [1,0,0,0,0,0], desc: "ä¸€é™½åˆç”Ÿï¼Œè¬ç‰©ä¹‹å§‹ã€‚", do: "é•·æœŸå­¸ç¿’, å„²å‚™è³‡é‡‘", dont: "æ€¥æ–¼æ±‚æˆ" },
    { name: "é ¤", yao: [1,0,0,0,0,1], desc: "è§€å…¶æ‰€é¤Šï¼Œè‡ªæ±‚å£å¯¦ã€‚", do: "é¤Šç”Ÿ, ç²¾é€²å°ˆæ¥­", dont: "æ•£æ’­æµè¨€" },
    { name: "å±¯", yao: [1,0,0,0,1,0], desc: "é›²é›·å±¯ï¼Œå‰µæ¥­ç¶­è‰±ã€‚", do: "å°‹æ‰¾å°å¸«, å»ºç«‹åœ˜éšŠ", dont: "ç¨è‡ªå†’éšª" },
    { name: "ç›Š", yao: [1,1,0,0,0,1], desc: "é¢¨é›·ç›Šï¼Œè¦‹å–„å‰‡é·ã€‚", do: "æ…ˆå–„æåŠ©, å…±äº«", dont: "è‡ªç§è‡ªåˆ©" },
    { name: "éœ‡", yao: [1,0,1,0,0,0], desc: "é›·è²é©šäººï¼Œå…§å¿ƒåçœã€‚", do: "å±æ©Ÿé æ¼”, æŸ¥æ ¸", dont: "é©šæ…Œå¤±æª" },
    { name: "å™¬å—‘", yao: [1,0,1,0,0,1], desc: "åˆ©ç”¨ç„ï¼Œæ¸…é™¤éšœç¤™ã€‚", do: "æ³•å¾‹è™•ç½®, æ–·æ¨é›¢", dont: "å„ªæŸ”å¯¡æ–·" },
    { name: "éš¨", yao: [1,0,0,1,1,0], desc: "éš¨æ™‚è€Œå‹•ï¼Œé †æ‡‰å¤§å‹¢ã€‚", do: "é †å‹¢è€Œç‚º, èå…¥", dont: "å‰›æ„è‡ªç”¨" },
    { name: "ç„¡å¦„", yao: [1,0,0,1,1,1], desc: "å¤©ä¸‹é›·è¡Œï¼Œä¸åšéåˆ†æƒ³ã€‚", do: "æœ¬åˆ†å·¥ä½œ, èª å¯¦", dont: "æŠ•æ©Ÿè³­åš" },
    { name: "æ˜å¤·", yao: [1,0,1,0,0,0], desc: "å…‰æ˜å…¥åœ°ï¼Œéš±è—é‹’èŠ’ã€‚", do: "éŸœå…‰é¤Šæ™¦, ç ”ç™¼", dont: "é‹’èŠ’å¤ªéœ²" },
    { name: "è³", yao: [1,0,1,0,0,1], desc: "å±±ä¸‹æœ‰ç«ï¼Œæ³¨é‡è£é£¾ã€‚", do: "å½¢è±¡å‡ç´š, æ–‡åŒ–", dont: "è¯è€Œä¸å¯¦" },
    { name: "æ—¢æ¿Ÿ", yao: [1,0,1,0,1,0], desc: "æ°´ç«æ—¢æ¿Ÿï¼Œé˜²æ­¢æ€ æ…¢ã€‚", do: "ç´°ç¯€ç¶­è­·, é˜²ç¯„", dont: "æ‰ä»¥è¼•å¿ƒ" },
    { name: "å®¶äºº", yao: [1,0,1,1,0,1], desc: "æ²»å®¶ç‚ºæœ¬ï¼Œå…§éƒ¨ç©©å®šã€‚", do: "å®¶åº­èšé¤, ç´€å¾‹", dont: "å¿½è¦–ä¼´ä¾¶" },
    { name: "è±", yao: [1,0,1,1,0,0], desc: "ç››å¤§ä¹‹æ™‚ï¼Œç‰©æ¥µå¿…åã€‚", do: "è³‡æºæ•´åˆ, åˆ†é…", dont: "å¾—æ„å¿˜å½¢" },
    { name: "é›¢", yao: [1,0,1,1,0,1], desc: "ä¾é™„å…‰æ˜ï¼Œå‚³æ‰¿æ–‡åŒ–ã€‚", do: "å°‹æ‰¾å°å¸«, å‚³æ‰¿", dont: "å­¤å‚²ç¨ç«‹" },
    { name: "é©", yao: [1,0,1,1,1,1], desc: "å¾¹åº•è®Šé©èˆ‡è½‰å‹ã€‚", do: "çµæ§‹é‡çµ„, æ›´æ–°", dont: "å¢¨å®ˆæˆè¦" },
    { name: "åŒäºº", yao: [1,1,1,1,0,1], desc: "æ‰“ç ´éš”é–¡ï¼Œå°‹æ±‚å¤§åŒã€‚", do: "è·¨ç•Œåˆä½œ, å…¬é–‹", dont: "å»ºç«‹ç§æ´¾" },
    { name: "è‡¨", yao: [1,1,0,0,0,0], desc: "åœ°æ¾¤è‡¨ï¼Œä¸»å‹•æ¨é€²ã€‚", do: "å±•ç¤ºæ‰è¯, æ¨å‹•", dont: "æ‡¶æƒ°æ‡ˆæ€ " },
    { name: "æ", yao: [1,1,0,0,0,1], desc: "å±±æ¾¤æï¼Œæ¸›æ¬²ä¿®èº«ã€‚", do: "ç²¾ç°¡é–‹æ”¯, ä¿®ç…‰", dont: "è²ªå¾—ç„¡å­" },
    { name: "ç¯€", yao: [1,1,0,0,1,0], desc: "åˆ¶å®šç¯€åº¦ï¼Œå®ˆè¦çŸ©ã€‚", do: "åˆ¶å®šè¦çŸ©, åš´å®ˆ", dont: "éåº¦åš´è‹›" },
    { name: "ä¸­å­š", yao: [1,1,0,0,1,1], desc: "èª ä¿¡åŠ›é‡ï¼Œæ„Ÿå‹•è¬ç‰©ã€‚", do: "å¥‘ç´„èª ä¿¡, æºé€š", dont: "èƒŒä¿¡å¿˜ç¾©" },
    { name: "æ­¸å¦¹", yao: [1,1,0,1,1,0], desc: "äººä¹‹çµ‚å§‹ï¼Œåä½å®œæ­£ã€‚", do: "é‡æ¸…å¥‘ç´„, æš«ç·©", dont: "è‰ç‡è¯å§»" },
    { name: "ç½", yao: [1,1,0,1,0,1], desc: "æ±‚åŒå­˜ç•°ï¼Œç¨ç«‹æ€è€ƒã€‚", do: "å°‹æ±‚å¹³è¡¡, æ€è€ƒ", dont: "æ¿€é€²çˆ­è«–" },
    { name: "å…Œ", yao: [1,1,0,1,1,0], desc: "å–œæ‚…å’Œè§£ï¼Œè—è¡“è¡¨é”ã€‚", do: "æ¼”è¬›æ•™å­¸, å¹½é»˜", dont: "å£å‡ºæƒ¡è¨€" },
    { name: "å±¥", yao: [1,1,0,1,1,1], desc: "å±¥è™å°¾ï¼Œç¦®æ•¸å‘¨å…¨ã€‚", do: "å‘¨å…¨ç¦®æ•¸, å°å¿ƒ", dont: "é­¯è½è¡Œäº‹" },
    { name: "æ³°", yao: [1,1,1,0,0,0], desc: "å¤©åœ°äº¤æ³°ï¼Œè¬ç‰©é€šã€‚", do: "å¤§è†½æ“´å¼µ, å¸ƒç½²", dont: "çŒ¶è±«ä¸æ±º" },
    { name: "å¤§ç•œ", yao: [1,1,1,0,0,1], desc: "ç©è“„å·¨å¤§èƒ½é‡èˆ‡çŸ¥è­˜ã€‚", do: "æ·±é€ å­¸ç¿’, å„²è“„", dont: "æ€¥æ–¼å¥—ç¾" },
    { name: "éœ€", yao: [1,1,1,0,1,0], desc: "é›²ä¸Šæ–¼å¤©ï¼Œè€å¿ƒç­‰å¾…ã€‚", do: "ä¿®èº«é¤Šæ€§, ç­‰å¾…", dont: "æ€¥èºä¸å®‰" },
    { name: "å°ç•œ", yao: [1,1,1,0,1,1], desc: "é¢¨è¡Œå¤©ä¸Šï¼Œå¾®èª¿ç´°ç¯€ã€‚", do: "ç´°ç¯€ä¿®æ­£, å¾®å‰µ", dont: "é‡å¿ƒéå¤§" },
    { name: "å¤§å£¯", yao: [1,1,1,1,0,0], desc: "é›·åœ¨å¤©ä¸Šï¼Œå®ˆç¦®å®ˆåˆ†ã€‚", do: "ç©©å¥æ¨é€², ç¶­æŒ", dont: "æ©«è¡ç›´æ’" },
    { name: "å¤§æœ‰", yao: [1,1,1,1,0,1], desc: "ç«åœ¨å¤©ä¸Šï¼Œå¤§å…¬ç„¡ç§ã€‚", do: "è³‡æºå…±äº«, å»£çµ", dont: "è‡ªç§éœ¸ä½”" },
    { name: "å¤¬", yao: [1,1,1,1,1,0], desc: "æ¾¤ä¸Šæ–¼å¤©ï¼Œæœæ–·æ¸…é™¤ã€‚", do: "æœæ–·è£å“¡, æ¸…ç†", dont: "å¿ƒè»ŸçŒ¶è±«" },
    { name: "å§¤", yao: [0,1,1,1,1,1], desc: "å¶ç„¶ç›¸é‡ï¼Œä¸å®œé•·ä¹…ã€‚", do: "éš¨æ©Ÿæ‡‰è®Š, è§€å¯Ÿ", dont: "è¼•æ˜“æ‰¿è«¾" }
];

const GZ = ["ç”²å­","ä¹™ä¸‘","ä¸™å¯…","ä¸å¯","æˆŠè¾°","å·±å·³","åºšåˆ","è¾›æœª","å£¬ç”³","ç™¸é…‰","ç”²æˆŒ","ä¹™äº¥","ä¸™å­","ä¸ä¸‘","æˆŠå¯…","å·±å¯","åºšè¾°","è¾›å·³","å£¬åˆ","ç™¸æœª","ç”²ç”³","ä¹™é…‰","ä¸™æˆŒ","ä¸äº¥","æˆŠå­","å·±ä¸‘","åºšå¯…","è¾›å¯","å£¬è¾°","ç™¸å·³","ç”²åˆ","ä¹™æœª","ä¸™ç”³","ä¸é…‰","æˆŠæˆŒ","å·±äº¥","åºšå­","è¾›ä¸‘","å£¬å¯…","ç™¸å¯","ç”²è¾°","ä¹™å·³","ä¸™åˆ","ä¸æœª","æˆŠç”³","å·±é…‰","åºšæˆŒ","è¾›äº¥","å£¬å­","ç™¸ä¸‘","ç”²å¯…","ä¹™å¯","ä¸™è¾°","ä¸å·³","æˆŠåˆ","å·±æœª","åºšç”³","è¾›é…‰","å£¬æˆŒ","ç™¸äº¥"];

function switchTab(idx) {
    document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
    document.querySelectorAll('.page').forEach((p, i) => p.classList.toggle('active', i === idx));
    if (idx === 3) drawTheoryCharts();
}

function setVal(v) {
    document.getElementById('mainInput').value = v;
    runCalculation();
}

function runCalculation() {
    const base = parseInt(document.getElementById('mainInput').value);
    if (isNaN(base)) return;

    // 1. å…¨ç¯‡æ¨ç®—
    const log = document.getElementById('full-calc-log');
    log.innerHTML = "";
    const offset = (base - 1984) % 60;
    const currentGZIdx = (offset < 0 ? offset + 60 : offset);
    const bodyNum = (base % 9) + 1;
    
    document.getElementById('summary-info').innerHTML = `
        èµ·å§‹åŸºæ•¸ï¼š${base} ï½œ çš‡æ¥µåº§æ¨™ï¼š${GZ[currentGZIdx]} ï½œ é«”æ•¸ï¼š${bodyNum}
    `;

    for (let i = 0; i < 60; i++) {
        const year = base + i;
        const gzIdx = (currentGZIdx + i) % 60;
        const hexIdx = (currentGZIdx + i) % HEX_DATA.length;
        const hex = HEX_DATA[hexIdx];
        const div = document.createElement('div');
        div.className = 'tiny-text';
        div.style.padding = "2px 0";
        div.style.borderBottom = "1px solid #f0f0f0";
        div.innerHTML = `<b>è¥¿å…ƒ ${year} (${GZ[gzIdx]})</b>: å€¼å¹´å¦ã€Œ${hex.name}ã€ - ${hex.desc}`;
        log.appendChild(div);
    }

    // 2. å¹²æ¶‰åœ–èˆ‡è¡Œç‚ºå»ºè­°
    drawInductionChart(base);
    renderBehavior(HEX_DATA[currentGZIdx % HEX_DATA.length]);
    renderGZTable(currentGZIdx);
}

function drawInductionChart(base) {
    const svg = d3.select("#vibration-svg");
    svg.selectAll("*").remove();
    const w = document.getElementById('vibration-svg').clientWidth;
    const h = 280, pad = 30;

    const bodyNum = (base % 9) + 5; 
    const data = Array.from({length: 60}, (_, t) => {
        const useNum = (t % 5) + 3;
        const s_t = 50 + (bodyNum * 2.5 * Math.cos(2 * Math.PI * t / 12)) + (useNum * 2 * Math.sin(2 * Math.PI * t / 30));
        return { x: t, y: s_t };
    });

    const x = d3.scaleLinear().domain([0, 59]).range([pad, w - pad]);
    const y = d3.scaleLinear().domain([0, 100]).range([h - pad, pad]);

    svg.append("path").datum(data).attr("fill", "none").attr("stroke", "var(--gold-dark)").attr("stroke-width", 2).attr("d", d3.line().x(d => x(d.x)).y(d => y(d.y)).curve(d3.curveBasis));
    svg.append("circle").attr("cx", x(data[0].x)).attr("cy", y(data[0].y)).attr("r", 5).attr("fill", "red");
}

function drawTheoryCharts() {
    const base = parseInt(document.getElementById('mainInput').value) || 1011;
    const bodyNum = (base % 9) + 5;
    
    const draw = (id, type) => {
        const svg = d3.select(id);
        svg.selectAll("*").remove();
        const w = svg.node().clientWidth, h = 120, pad = 20;
        const data = Array.from({length: 60}, (_, t) => {
            const val = type === 'body' ? Math.cos(2 * Math.PI * t / 12) : Math.sin(2 * Math.PI * t / 30);
            return { x: t, y: 50 + val * 30 };
        });
        const x = d3.scaleLinear().domain([0, 59]).range([pad, w - pad]);
        const y = d3.scaleLinear().domain([0, 100]).range([h - pad, pad]);
        svg.append("path").datum(data).attr("fill", "none").attr("stroke", type==='body'?'#3e2723':'#b8860b').attr("d", d3.line().x(d => x(d.x)).y(d => y(d.y)));
    };
    draw("#body-chart", "body");
    draw("#use-chart", "use");
}

function renderBehavior(hex) {
    const el = document.getElementById('behavior-detail');
    el.innerHTML = `
        <div class="card" style="display:flex; align-items:center; gap:10px;">
            <div class="hex-box">
                ${hex.yao.map(y => `<div class="yao ${y===1?'yang':'yin'}"></div>`).join('')}
            </div>
            <div><p><b>ç•¶å‰å¦è±¡ï¼š${hex.name}</b></p><p>${hex.desc}</p></div>
        </div>
        <div class="card" style="background:var(--gold-light);">
            <p><b>å®œï¼š</b> ${hex.do}</p><p><b>å¿Œï¼š</b> ${hex.dont}</p>
        </div>
    `;
}

function renderGZTable(currentIdx) {
    const el = document.getElementById('gz-distribution');
    el.innerHTML = "";
    GZ.forEach((n, i) => {
        const span = document.createElement('span');
        span.className = 'history-item';
        if (i === currentIdx) span.style.background = 'var(--gold-dark)';
        if (i === currentIdx) span.style.color = 'white';
        span.innerText = n;
        el.appendChild(span);
    });
}

function downloadLogic() {
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "HuangJi_Induction_Full_System.html";
    a.click();
}

window.onload = runCalculation;
</script>
</body>
</html>
