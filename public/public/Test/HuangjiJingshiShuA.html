<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äººç”Ÿ 60 å¦ãƒ»é»ƒé‡‘æ±ºç­–å®Œæ•´ç³»çµ±</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
:root {
    --gold-primary: #ffd700;
    --gold-dark: #b8860b;
    --gold-light: #fff9e6;
    --bg-gold: radial-gradient(circle, #fdf5e6 0%, #ffd700 100%);
    --font-small: 0.5rem;
}

body {
    font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
    background: var(--bg-gold);
    background-image: url('https://www.transparenttextures.com/patterns/gold-dust.png');
    color: #4a3c00;
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.container {
    width: 100%;
    max-width: 600px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    border: 3px solid var(--gold-dark);
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    padding: 20px;
    box-sizing: border-box;
    position: relative;
}

h1 {
    font-size: 1.4rem;
    text-align: center;
    color: var(--gold-dark);
    text-shadow: 1px 1px 2px #fff;
    margin-bottom: 15px;
}

.tabs {
    display: flex;
    justify-content: space-around;
    border-bottom: 2px solid var(--gold-dark);
    margin-bottom: 15px;
}

.tab {
    padding: 10px;
    font-size: 0.7rem;
    cursor: pointer;
    font-weight: bold;
    color: #888;
    transition: 0.3s;
}

.tab.active {
    color: var(--gold-dark);
    border-bottom: 4px solid var(--gold-dark);
    transform: scale(1.1);
}

.content-page {
    display: none;
    min-height: 300px;
}

.content-page.active {
    display: block;
}

/* 0.5rem åš´æ ¼æ§åˆ¶ */
.tiny-text {
    font-size: var(--font-small) !important;
    line-height: 1.4;
    color: #554400;
}

.card {
    background: linear-gradient(135deg, #ffffff 0%, #fffdf0 100%);
    border: 1px solid var(--gold-primary);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 15px;
    box-shadow: 3px 3px 10px rgba(184, 134, 11, 0.15);
}

.input-group {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
}

input, button {
    border: 2px solid var(--gold-dark);
    border-radius: 8px;
    padding: 8px;
    font-size: 0.8rem;
    outline: none;
}

button {
    background: linear-gradient(to bottom, #ffd700, #b8860b);
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}

.grid-60 {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 3px;
}

.hex-cell {
    aspect-ratio: 1;
    background: #eee;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.4rem;
}

.hex-cell.active {
    background: var(--gold-dark);
    color: white;
    box-shadow: 0 0 8px var(--gold-primary);
}

.highlight-box {
    border-left: 4px solid var(--gold-dark);
    padding-left: 10px;
    margin: 10px 0;
}

#download-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-size: 0.6rem;
    padding: 10px;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.strategy-label {
    display: inline-block;
    padding: 2px 6px;
    background: var(--gold-dark);
    color: white;
    border-radius: 4px;
    font-weight: bold;
    margin-right: 5px;
}
</style>
</head>
<body>

<div class="container">
    <h1>ğŸ† äººç”Ÿå…­åå¦ãƒ»å¤§æ•¸æ“šæ±ºç­–ç³»çµ±</h1>

    <div class="card">
        <div class="input-group">
            <span class="tiny-text">å‡ºç”Ÿå¹´ï¼š</span>
            <input id="birthYear" type="number" value="1975">
            <button onclick="calculateDeepFate()">æ¼”ç®—å¤©æ©Ÿ</button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab(0)">å¤©æ™‚å¦è±¡</div>
        <div class="tab" onclick="switchTab(1)">è¡Œç‚ºç­–ç•¥</div>
        <div class="tab" onclick="switchTab(2)">èƒ½é‡åœ°åœ–</div>
    </div>

    <!-- é é¢ 0: å¤©æ™‚å¦è±¡ -->
    <div id="page0" class="content-page active">
        <div id="res-header" class="card">
            <p class="tiny-text">è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¼”ç®—æ‚¨çš„ç•¶å‰äººç”Ÿåº§æ¨™ã€‚</p>
        </div>
        <div class="card">
            <p class="tiny-text"><b>ã€äººç”Ÿç›¸ä½é€²åº¦åœ–ã€‘</b></p>
            <div id="grid60" class="grid-60"></div>
            <p class="tiny-text" style="margin-top:8px;">*æ¯ä¸€å°æ ¼ä»£è¡¨äººç”Ÿå…­åå€‹è®Šæ›´é»ä¸­çš„ä¸€å€‹å–®ä½ã€‚</p>
        </div>
    </div>

    <!-- é é¢ 1: è¡Œç‚ºç­–ç•¥ -->
    <div id="page1" class="content-page">
        <div id="strategy-res">
            <div class="card">
                <p class="tiny-text">æ¼”ç®—ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- é é¢ 2: èƒ½é‡åœ°åœ– -->
    <div id="page2" class="content-page">
        <div class="card">
            <p class="tiny-text"><b>ã€å¹´åº¦èƒ½é‡åˆ†ä½ˆã€‘</b></p>
            <div id="energy-chart"></div>
            <div id="energy-detail" class="tiny-text"></div>
        </div>
    </div>

    <div id="info-status" class="tiny-text" style="text-align:center; color: #b8860b;"></div>
</div>

<button id="download-btn" onclick="downloadSelf()">ä¸‹è¼‰<br>ç¨‹å¼</button>

<script>
/**
 * ç³»çµ±è¦æ ¼ï¼š
 * 1. çµåˆå…­åç”²å­å¹²æ”¯èˆ‡æ˜“ç¶“å‹•èƒ½ã€‚
 * 2. ç²¾ç¢ºæ¼”ç®— 1-60 çš„è¡Œç‚ºçŸ©é™£ã€‚
 * 3. åš´æ ¼ç¬¦åˆ 0.5rem è¼¸å‡ºè¦ç¯„ã€‚
 */

const GAN_ZHI = ["ç”²å­","ä¹™ä¸‘","ä¸™å¯…","ä¸å¯","æˆŠè¾°","å·±å·³","åºšåˆ","è¾›æœª","å£¬ç”³","ç™¸é…‰","ç”²æˆŒ","ä¹™äº¥","ä¸™å­","ä¸ä¸‘","æˆŠå¯…","å·±å¯","åºšè¾°","è¾›å·³","å£¬åˆ","ç™¸æœª","ç”²ç”³","ä¹™é…‰","ä¸™æˆŒ","ä¸äº¥","æˆŠå­","å·±ä¸‘","åºšå¯…","è¾›å¯","å£¬è¾°","ç™¸å·³","ç”²åˆ","ä¹™æœª","ä¸™ç”³","ä¸é…‰","æˆŠæˆŒ","å·±äº¥","åºšå­","è¾›ä¸‘","å£¬å¯…","ç™¸å¯","ç”²è¾°","ä¹™å·³","ä¸™åˆ","ä¸æœª","æˆŠç”³","å·±é…‰","åºšæˆŒ","è¾›äº¥","å£¬å­","ç™¸ä¸‘","ç”²å¯…","ä¹™å¯","ä¸™è¾°","ä¸å·³","æˆŠåˆ","å·±æœª","åºšç”³","è¾›é…‰","å£¬æˆŒ","ç™¸äº¥"];

// åå¹´ç‚ºä¸€æ—¬çš„æ·±åº¦ç­–ç•¥çŸ©é™£
const DEEP_STRATEGY = [
    {
        title: "ç¬¬ä¸€æ—¬ï¼šç”²å­èµ·é‹ (1-10)",
        core: "æ½›é¾å‹¿ç”¨ï¼Œæ·±æ ¹å›ºæœ¬",
        advice: "æ­¤éšæ®µå¦‚æ˜¥æœ¨èŒèŠ½ã€‚åƒ¹å€¼åœ¨æ–¼ã€Œå¸æ”¶ã€è€Œéã€Œè¼¸å‡ºã€ã€‚å®œå°‹æ‰¾è‰¯å¸«ã€å»ºç«‹åº•å±¤é‚è¼¯ã€‚",
        do: ["å»ºç«‹é–±è®€ç¿’æ…£", "å¤šé ˜åŸŸæ‰“é›œç£¨ç·´", "é«”èƒ½åŸºç¤é–‹ç™¼"],
        dont: ["è¿½æ±‚çŸ­æœŸç²åˆ©", "éæ—©å…¬é–‹åº•ç‰Œ"],
        lucky_dir: "æ­£æ±æ–¹"
    },
    {
        title: "ç¬¬äºŒæ—¬ï¼šç”²æˆŒç®¡ç† (11-20)",
        core: "è¦‹é¾åœ¨ç”°ï¼Œåˆ©è¦‹å¤§äºº",
        advice: "èƒ½é‡é–‹å§‹å¤–æº¢ã€‚åƒ¹å€¼åœ¨æ–¼ã€Œç¤¾äº¤ã€èˆ‡ã€Œåé¥‹ã€ã€‚å®œé€éå¤–éƒ¨ç¢°æ’ä¿®æ­£è‡ªå·±çš„æ–¹å‘ã€‚",
        do: ["æ“´å¤§ç¤¾äº¤åœˆ", "å…¬é–‹ç™¼è¡¨å€‹äººæ„è¦‹", "è·¨ç•Œåˆä½œé …ç›®"],
        dont: ["å®…å®¶å­¤è»å¥®æˆ°", "å®³æ€•å¤±æ•—è€Œæ­¢æ­¥"],
        lucky_dir: "æ±å—æ–¹"
    },
    {
        title: "ç¬¬ä¸‰æ—¬ï¼šç”²ç”³ç²¾é€² (21-30)",
        core: "çµ‚æ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥å²",
        advice: "èƒ½é‡å·”å³°ã€‚åƒ¹å€¼åœ¨æ–¼ã€Œæ•ˆç‡ã€èˆ‡ã€Œæ§“æ¡¿ã€ã€‚å®œå»ºç«‹æ¨™æº–åŒ–æµç¨‹ï¼Œé¿å…æ¶ˆè€—åœ¨é‡è¤‡å‹å‹•ä¸­ã€‚",
        do: ["è‡ªå‹•åŒ–å·¥å…·é–‹ç™¼", "å“ç‰Œè­·åŸæ²³å»ºç«‹", "è³‡ç”¢çµæ§‹åŒ–"],
        dont: ["é«”åŠ›æå‘½", "å¿½ç•¥æ³•å¾‹èˆ‡ç¨…å‹™é¢¨éšª"],
        lucky_dir: "æ­£å—æ–¹"
    },
    {
        title: "ç¬¬å››æ—¬ï¼šç”²åˆè®Šé© (31-40)",
        core: "æˆ–èºåœ¨æ·µï¼Œç„¡å’",
        advice: "èƒ½é‡è½‰æ›é»ã€‚åƒ¹å€¼åœ¨æ–¼ã€ŒæŠ‰æ“‡ã€èˆ‡ã€Œæ”¾æ£„ã€ã€‚å®œåšäººç”Ÿæ¸›æ³•ï¼Œå°ˆæ³¨æ–¼æœ€å…·é•·æœŸåƒ¹å€¼çš„ 20% è¡Œå‹•ã€‚",
        do: ["æ–·æ¨é›¢ç„¡æ•ˆäººè„ˆ", "æ ¸å¿ƒæŠ€èƒ½æ·±æŒ–", "èº«å¿ƒå¥åº·é‡å•Ÿ"],
        dont: ["ç¡¬æ’èˆŠæ¥­å‹™", "ææ‡¼å¤±å»ç¾æœ‰å…‰ç’°"],
        lucky_dir: "è¥¿å—æ–¹"
    },
    {
        title: "ç¬¬äº”æ—¬ï¼šç”²è¾°çµæˆ (41-50)",
        core: "é£›é¾åœ¨å¤©ï¼Œå¤§äººé€ ä¹Ÿ",
        advice: "èƒ½é‡æˆç†ŸæœŸã€‚åƒ¹å€¼åœ¨æ–¼ã€Œè³¦èƒ½ã€èˆ‡ã€Œé¡§å•ã€ã€‚å®œé€éæŒ‡å°ä»–äººå¯¦ç¾è‡ªæˆ‘åƒ¹å€¼æœ€å¤§åŒ–ã€‚",
        do: ["å°å¸«èˆ‡é¡§å•è§’è‰²", "çŸ¥è­˜é«”ç³»åŒ–è¼¸å‡º", "é•·æœŸè³‡æœ¬æŠ•è³‡"],
        dont: ["å‡¡äº‹è¦ªåŠ›è¦ªç‚º", "èˆ‡å¹´è¼•äººæ¯”æ‹¼é€Ÿåº¦"],
        lucky_dir: "æ­£è¥¿æ–¹"
    },
    {
        title: "ç¬¬å…­æ—¬ï¼šç”²å¯…å‚³æ‰¿ (51-60)",
        core: "äº¢é¾æœ‰æ‚”ï¼Œèˆ‡æ™‚å•è¡Œ",
        advice: "èƒ½é‡å…¥åº«æœŸã€‚åƒ¹å€¼åœ¨æ–¼ã€Œå‚³æ‰¿ã€èˆ‡ã€Œå®‰éœã€ã€‚å®œå°ˆæ³¨æ–¼éˆé­‚æ·±åº¦ï¼Œç‚ºä¸‹ä¸€è¼ªå¤§å¾ªç’°è“„èƒ½ã€‚",
        do: ["æ…ˆå–„èˆ‡å›é¥‹", "å“²å­¸èˆ‡å†¥æƒ³", "å®¶æ—å‚³æ‰¿è¦åŠƒ"],
        dont: ["é‡è¿”é«˜å£“æˆ°å ´", "éåº¦è¿½æ±‚æ„Ÿå®˜åˆºæ¿€"],
        lucky_dir: "è¥¿åŒ—æ–¹"
    }
];

function switchTab(idx) {
    document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
    document.querySelectorAll('.content-page').forEach((p, i) => p.classList.toggle('active', i === idx));
}

function calculateDeepFate() {
    const bYear = parseInt(document.getElementById('birthYear').value);
    if (!bYear) return;

    const currentYear = new Date().getFullYear();
    const age = currentYear - bYear;
    
    // å¹²æ”¯æ›ç®—
    const birthIdx = (bYear - 4) % 60;
    const currentIdx = (birthIdx + age) % 60;
    const safeIdx = currentIdx < 0 ? currentIdx + 60 : currentIdx;
    
    const hexNum = safeIdx + 1;
    const strategyIdx = Math.floor(safeIdx / 10);
    const strat = DEEP_STRATEGY[strategyIdx];

    // æ›´æ–°ç•¶å‰ä½ç½®é é¢
    document.getElementById('res-header').innerHTML = `
        <p class="tiny-text"><b>ã€ç•¶å‰å¤©æ™‚åº§æ¨™ã€‘</b></p>
        <p class="tiny-text" style="color:var(--gold-dark); font-size:0.7rem !important; font-weight:bold;">
            ${currentYear} å¹´ï½œæ­²æ¬¡ ${GAN_ZHI[safeIdx]}
        </p>
        <div class="highlight-box tiny-text">
            <b>ç”Ÿå‘½ç›¸ä½ï¼š</b>äººç”Ÿç¬¬ ${hexNum} å¦<br>
            <b>ç›®å‰å¹´é½¡ï¼š</b>${age} æ­²<br>
            <b>æœ¬éšæ®µä¸»é¡Œï¼š</b>${strat.title}
        </div>
        <p class="tiny-text"><i>"${strat.core}"</i></p>
    `;

    // æ›´æ–°ç­–ç•¥é é¢
    document.getElementById('strategy-res').innerHTML = `
        <div class="card">
            <p class="tiny-text"><span class="strategy-label">æ ¸å¿ƒå»ºè­°</span>${strat.advice}</p>
        </div>
        <div class="card">
            <p class="tiny-text"><b>âœ… é»ƒé‡‘è¡Œå‹•è¡Œç‚ºæŒ‡å—ï¼š</b></p>
            <ul class="tiny-text" style="padding-left:15px;">
                ${strat.do.map(d => `<li>${d}</li>`).join('')}
            </ul>
        </div>
        <div class="card">
            <p class="tiny-text"><b>âŒ é»‘æ´é¢¨éšªç¦å¿Œæ¸…å–®ï¼š</b></p>
            <ul class="tiny-text" style="padding-left:15px;">
                ${strat.dont.map(d => `<li>${d}</li>`).join('')}
            </ul>
        </div>
        <div class="card">
            <p class="tiny-text"><b>ğŸ§­ èƒ½é‡è²´äººæ–¹ä½ï¼š</b>${strat.lucky_dir}</p>
        </div>
    `;

    // ç¹ªè£½æ ¼é»åœ–
    renderGrid(hexNum);
    // ç¹ªè£½èƒ½é‡åœ–
    renderEnergy(hexNum);
}

function renderGrid(activeNum) {
    const container = document.getElementById('grid60');
    container.innerHTML = '';
    for (let i = 1; i <= 60; i++) {
        const cell = document.createElement('div');
        cell.className = 'hex-cell' + (i === activeNum ? ' active' : '');
        cell.innerText = i;
        container.appendChild(cell);
    }
}

function renderEnergy(activeNum) {
    const container = document.getElementById('energy-chart');
    container.innerHTML = '';
    
    // ä½¿ç”¨ D3 ç¹ªè£½ä¸€å€‹ç°¡å–®çš„è¶¨å‹¢æ›²ç·š
    const data = Array.from({length: 60}, (_, i) => ({
        x: i + 1,
        y: Math.sin((i / 60) * Math.PI * 2) * 50 + 50 // æ³¢å‹•æ›²ç·š
    }));

    const width = container.clientWidth || 300;
    const height = 100;

    const svg = d3.select("#energy-chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    const x = d3.scaleLinear().domain([1, 60]).range([0, width]);
    const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);

    const line = d3.line()
        .x(d => x(d.x))
        .y(d => y(d.y))
        .curve(d3.curveBasis);

    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "var(--gold-dark)")
        .attr("stroke-width", 2)
        .attr("d", line);

    // æ¨™è¨»ç•¶å‰ä½ç½®
    const currentY = data[activeNum-1].y;
    svg.append("circle")
        .attr("cx", x(activeNum))
        .attr("cy", y(currentY))
        .attr("r", 5)
        .attr("fill", "red")
        .attr("stroke", "white");

    document.getElementById('energy-detail').innerHTML = `
        <p style="margin-top:10px;">ç›®å‰èƒ½é‡æ°´ä½ï¼š${Math.round(currentY)}%<br>
        *æ›²ç·šä»£è¡¨äººç”Ÿå‹•èƒ½çš„æ¼²è½è¦å¾‹ã€‚ç´…é»ç‚ºæ‚¨ç¾åœ¨çš„èƒ½é‡æ¶ˆè€—/ç”¢å‡ºæ¯”ç‡ã€‚</p>
    `;
}

function downloadSelf() {
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `Life_60_System_${new Date().getTime()}.html`;
    a.click();
}

window.onload = calculateDeepFate;
</script>

</body>
</html>
