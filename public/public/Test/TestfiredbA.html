<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase RTDB ç®¡ç†çµ‚ç«¯ï½œFULL VERSION</title>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
:root{
  --gold:#b8860b;
  --bg:#fff8dc;
  --ok:#065f46;
  --err:#9b1c1c;
}
body{
  margin:0;
  padding:14px;
  font-family:system-ui,"Noto Sans TC",sans-serif;
  background:var(--bg);
}
h1{font-size:18px;margin-bottom:6px}
.card{
  background:#fff;
  border:2px solid var(--gold);
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
}
.status{
  padding:8px;
  border-radius:6px;
  font-size:13px;
  margin-bottom:6px;
}
.ok{background:#e6fffa;color:var(--ok)}
.err{background:#fff5f5;color:var(--err)}
button{
  width:100%;
  margin-top:6px;
  padding:10px;
  border-radius:8px;
  border:none;
  background:linear-gradient(#ffd700,#b8860b);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button.danger{
  background:linear-gradient(#ef4444,#7f1d1d);
}
pre{
  background:#111;
  color:#0f0;
  padding:10px;
  border-radius:8px;
  font-size:11px;
  max-height:200px;
  overflow:auto;
}
</style>
</head>

<body>

<h1>ğŸ›  Firebase Realtime Database ç®¡ç†çµ‚ç«¯</h1>

<div class="card">
  <div id="authStatus" class="status">Authï¼šåˆå§‹åŒ–ä¸­â€¦</div>
  <div id="dbStatus" class="status">DBï¼šåˆå§‹åŒ–ä¸­â€¦</div>
</div>

<div class="card">
  <button onclick="writeTest()">âœï¸ å¯«å…¥æ¸¬è©¦è³‡æ–™</button>
  <button class="danger" onclick="resetDB()">â™»ï¸ æ¸…ç©ºæ•´å€‹ RTDB</button>
</div>

<div class="card">
  <h3>ğŸ“¦ å³æ™‚è³‡æ–™é è¦½</h3>
  <pre id="dataView">{}</pre>
</div>

<script>
/* ================= Firebase è¨­å®š ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCWym1iE7Rq2UAiFKhQMNuvHm_sHoCBbbw",
  authDomain: "keepsound-firebase-1c386.firebaseapp.com",
  databaseURL: "https://keepsound-firebase-1c386-default-rtdb.firebaseio.com",
  projectId: "keepsound-firebase-1c386"
};

/* ================= åˆå§‹åŒ– ================= */
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.database();

const authStatus = document.getElementById("authStatus");
const dbStatus   = document.getElementById("dbStatus");
const dataView   = document.getElementById("dataView");

/* ================= Authï¼ˆå¿…è¦ï¼‰ ================= */
auth.signInAnonymously()
.then(res=>{
  authStatus.className="status ok";
  authStatus.innerText="Auth OKï¼ˆåŒ¿åï¼‰ UID: "+res.user.uid.substring(0,8);
})
.catch(err=>{
  authStatus.className="status err";
  authStatus.innerText="Auth Error: "+err.message;
});

/* ================= DB é€£ç·šç‹€æ…‹ ================= */
db.ref(".info/connected").on("value",snap=>{
  if(snap.val()){
    dbStatus.className="status ok";
    dbStatus.innerText="Realtime Database å·²é€£ç·š";
  }else{
    dbStatus.className="status err";
    dbStatus.innerText="Realtime Database æ–·ç·š";
  }
});

/* ================= å³æ™‚è³‡æ–™ç›£è½ ================= */
db.ref().on("value",snap=>{
  dataView.textContent = JSON.stringify(snap.val() || {}, null, 2);
});

/* ================= å¯«å…¥æ¸¬è©¦ ================= */
function writeTest(){
  db.ref("tests").push({
    time: new Date().toISOString(),
    message: "Hello Firebase RTDB",
    uid: auth.currentUser?.uid || "unknown"
  })
  .then(()=>alert("âœ… å¯«å…¥æˆåŠŸ"))
  .catch(e=>alert("âŒ å¯«å…¥å¤±æ•—ï¼š"+e.message));
}

/* ================= æ¸…ç©º DB ================= */
function resetDB(){
  if(!confirm("âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ•´å€‹ Realtime Databaseï¼Ÿ")) return;
  db.ref().remove()
  .then(()=>alert("âœ… RTDB å·²æ¸…ç©º"))
  .catch(e=>alert("âŒ æ¸…ç©ºå¤±æ•—ï¼š"+e.message));
}
</script>

</body>
</html>
