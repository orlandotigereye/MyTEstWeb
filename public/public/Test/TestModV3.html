<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹™å·³é›†æˆå¤§åŒ¯ç¸½ V16 - çµ‚æ¥µè¦–è¦ºç‰ˆ</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://orlandotigereye.github.io/mytestweb/public/public/core.js"></script>
    <style>
        :root { --bg-gold: #FFFDE7; --main-gold: #D4AF37; --deep-gold: #B8860B; --coin-gold: #FFD700; --text-brown: #3E2723; --gold-grad: linear-gradient(135deg, #FFD700 0%, #FFF176 50%, #DAA520 100%); --font-size: 0.5rem; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg-gold) url('https://www.transparenttextures.com/patterns/gold-dust.png'); color: var(--text-brown); font-size: var(--font-size); width: 100vw; overflow-x: hidden; }
        header { height: 45px; background: var(--gold-grad); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; border-bottom: 2px solid var(--deep-gold); font-weight: 900; position: sticky; top:0; z-index:1000; }
        .status-bar { background: rgba(255,255,255,0.9); padding: 5px; display: flex; gap: 8px; border-bottom: 1px solid var(--main-gold); font-size: 0.4rem; overflow-x: auto; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
        .ok { background: #2E7D32; } .fail { background: #C62828; }
        .nav-tabs { display: flex; background: #FFF; border-bottom: 1px solid var(--main-gold); position: sticky; top:45px; z-index:1000; }
        .tab { flex: 1; text-align: center; padding: 12px 0; font-weight: 900; color: #A68B5A; cursor: pointer; }
        .tab.active { background: rgba(255, 215, 0, 0.2); border-bottom: 3px solid var(--deep-gold); color: var(--text-brown); }
        .content { padding: 10px; padding-bottom: 80px; }
        .page { display: none; } .page.active { display: block; }
        .card { background: #fff; border: 1.5px solid var(--coin-gold); border-radius: 8px; padding: 10px; margin-bottom: 10px; box-shadow: 2px 2px 8px rgba(0,0,0,0.05); }
        .title-gold { color: var(--deep-gold); font-weight: 900; margin-bottom: 8px; border-left: 4px solid var(--main-gold); padding-left: 8px; }
        textarea { width: 100%; height: 100px; border: 1.5px solid var(--main-gold); border-radius: 4px; padding: 8px; font-size: 0.5rem; background: #FFFEF9; }
        .btn-p { background: var(--gold-grad); border: 1px solid var(--deep-gold); color: var(--text-brown); font-weight: 900; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; margin-top: 10px; }
        
        /* ç¸½çµæ„è±¡åœ–æ¨£å¼ */
        .visual-container { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .v-card { 
            width: 320px; height: 200px; background: #FFFEF0; border: 4px double var(--main-gold); 
            border-radius: 12px; position: relative; padding: 15px; overflow: hidden;
            box-shadow: 5px 5px 15px rgba(184, 134, 11, 0.2);
        }
        .v-bg-text { position: absolute; bottom: -10px; right: -5px; font-size: 6rem; color: rgba(212, 175, 55, 0.08); font-weight: 900; z-index: 0; }
        .v-header { border-bottom: 1.5px solid var(--main-gold); padding-bottom: 5px; margin-bottom: 10px; font-weight: 900; display: flex; justify-content: space-between; z-index: 1; position: relative; }
        .v-body { font-size: 0.55rem; line-height: 1.6; color: #4E342E; z-index: 1; position: relative; height: 105px; }
        .v-footer { border-top: 1px dashed var(--main-gold); margin-top: 5px; padding-top: 5px; font-size: 0.4rem; display: flex; justify-content: space-between; z-index: 1; position: relative; color: var(--deep-gold); }
        .logo-box { display: flex; align-items: center; gap: 4px; }
        .logo-coin { width: 12px; height: 12px; background: var(--gold-grad); border: 1px solid var(--deep-gold); border-radius: 50%; }

        .dl-btn { position: fixed; bottom: 10px; right: 10px; width: 45px; height: 45px; background: #000; color: #fff; border-radius: 50%; font-size: 0.4rem; z-index: 3000; border: 1.5px solid var(--coin-gold); text-align: center; display: flex; align-items: center; justify-content: center; }
        .loading-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: none; color: #fff; align-items: center; justify-content: center; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>ğŸ”± ä¹™å·³å¤§åŒ¯ç¸½ Pro V16</header>
<div class="status-bar" id="mod-status"></div>

<nav class="nav-tabs">
    <div class="tab active" onclick="goTab(0)">å¤©æ©ŸéŒ„å…¥</div>
    <div class="tab" onclick="goTab(1)">ç¸½çµæ„è±¡</div>
</nav>

<div class="content">
    <div id="p0" class="page active">
        <div class="card">
            <div class="title-gold">æ•¸æ“šå¤§åŒ¯ç¸½è¼¸å…¥</div>
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <button class="btn-p" style="margin:0; flex:1;" onclick="pasteIn()">ğŸ“‹ è²¼ä¸Š</button>
                <button class="btn-p" style="margin:0; flex:1; background:#f5f5f5;" onclick="clearIn()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            <textarea id="main-in">æœ€è¿‘æ˜Ÿé«”: Saturn (è·é›¢: 1.45 AU)
æœˆç›¸ç‹€æ…‹: ä¸‹å¼¦æœˆ (æ€¥è®ŠæœŸ)
å—è¨ªè€…å¹²æ”¯: ä¹™å·³ æˆŠå­ ä¸å¯ ç™¸å¯
äº”è¡Œèƒ½é‡: æœ¨:30 ç«:45 åœŸ:20 é‡‘:10 æ°´:50
å­—å…¸æ„Ÿæ‡‰: å®ˆ, çŠ¯, æ©, è•</textarea>
            <button class="btn-p" onclick="masterSummation()">ğŸš€ å•Ÿå‹•å…¨æ•¸æ“šå¤§åŒ¯ç¸½æ¨æ¼”</button>
        </div>
        <div id="status-note" style="font-size:0.4rem; color:red; padding:5px;"></div>
    </div>

    <div id="p1" class="page">
        <div class="visual-container" id="visual-area">
            <div class="v-card" id="v-heaven">
                <div class="v-bg-text">å¤©</div>
                <div class="v-header"><span>ã€å¤©æ™‚ãƒ»ä¹™å·³åˆ¤åˆ†å·ã€‘</span><span id="res-score"></span></div>
                <div class="v-body" id="res-heaven-body"></div>
                <div class="v-footer"><div class="logo-box"><div class="logo-coin"></div>ä¹™å·³èªè­‰</div><span id="v-date1"></span></div>
            </div>
            <div class="v-card" id="v-earth">
                <div class="v-bg-text">åœ°</div>
                <div class="v-header"><span>ã€åœ°æ°£ãƒ»å±€å‹¢æ€¥ç·©å·ã€‘</span><span id="res-urg"></span></div>
                <div class="v-body" id="res-earth-body"></div>
                <div class="v-footer"><div class="logo-box"><div class="logo-coin"></div>ä¹™å·³èªè­‰</div><span id="v-date2"></span></div>
            </div>
            <div class="v-card" id="v-human">
                <div class="v-bg-text">äºº</div>
                <div class="v-header"><span>ã€äººé‹ãƒ»äº”è¡Œé•·ç”Ÿå·ã€‘</span><span id="res-stage"></span></div>
                <div class="v-body" id="res-human-body"></div>
                <div class="v-footer"><div class="logo-box"><div class="logo-coin"></div>ä¹™å·³èªè­‰</div><span id="v-date3"></span></div>
            </div>
            <div class="v-card" id="v-total" style="background: var(--gold-grad);">
                <div class="v-bg-text" style="color:rgba(0,0,0,0.05)">ç¸½</div>
                <div class="v-header" style="border-color:#3E2723"><span>ã€çµ‚æ¥µæ±ºç­–å¤§åŒ¯ç¸½ã€‘</span><span>LOGO</span></div>
                <div class="v-body" id="res-total-body" style="color:#000; font-weight:bold;"></div>
                <div class="v-footer" style="border-color:#3E2723; color:#3E2723"><div>å®˜æ–¹å”¯ä¸€æˆæ¬Š</div><span>2025/12/27</span></div>
            </div>
        </div>
        <button class="btn-p" onclick="exportImages()">ğŸ“¥ å°å‡ºå…¨å¥—ç¸½çµæ„è±¡åœ–</button>
    </div>
</div>

<div class="loading-mask" id="loader">âŒ› å¤§åŒ¯ç¸½è¨ˆç®—ä¸­...</div>
<div class="dl-btn" onclick="downloadCode()">ä¸‹è¼‰<br>ä»£ç¢¼</div>

<script>
    let API_KEY = ""; let IS_AI = false;
    const ECI_RULES = {
        Stars: { "Saturn": -17, "Mars": -7, "Jupiter": 9, "Venus": 6, "Sun": 8, "Moon": 7 },
        Dict: { "å®ˆ": "æ ¹åŸºç©©å›º", "çŠ¯": "å¤–åŠ›æ²–å‰‹", "æ©": "éš±æ†‚æµ®ç¾", "è•": "èƒ½é‡è™§æ" }
    };

    async function init() {
        try {
            const res = await fetch("https://orlandotigereye.github.io/mytestweb/config/api.js");
            const txt = await res.text();
            const m = txt.match(/"([a-fA-F0-9]+)"/);
            if(m) {
                API_KEY = decodeHex(m[1]);
                const ck = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${API_KEY}`);
                IS_AI = ck.ok;
            }
        } catch(e) {}
        await Core.initAll(); renderStatus();
        if(!IS_AI) $('#status-note').text("âš ï¸ AI å·²æ–·é–‹ï¼šç›®å‰ç”±ã€Œä¹™å·³ V10.5 åœ¨åœ°é›†æˆå¼•æ“ã€é€²è¡Œ 4 å¼µåœ–å¤§åŒ¯ç¸½æ¨ç®—ã€‚");
    }

    function decodeHex(h){ let s=""; for(let i=0;i<h.length;i+=2) s+=String.fromCharCode(parseInt(h.substr(i,2),16)); return s; }
    function renderStatus(){
        const con = $('#mod-status').empty();
        con.append(`<span><i class="status-dot ${IS_AI?'ok':'fail'}"></i>AI_Key</span>`);
        if(Core.modules) Object.entries(Core.modules).forEach(([k,v])=>con.append(`<span><i class="status-dot ${v.status?'ok':'fail'}"></i>${k}</span>`));
    }

    function pasteIn(){ navigator.clipboard.readText().then(t=>$('#main-in').val(t)); }
    function clearIn(){ $('#main-in').val(''); }
    function goTab(i){ $('.page').removeClass('active'); $(`#p${i}`).addClass('active'); $('.tab').removeClass('active').eq(i).addClass('active'); }

    async function masterSummation() {
        const input = $('#main-in').val();
        $('#loader').css('display', 'flex');

        // 1. è¨ˆç®—æ•¸æ“š
        let score = 0;
        Object.entries(ECI_RULES.Stars).forEach(([k,v]) => { if(input.includes(k)) score += v; });
        const urg = input.includes("ä¸‹å¼¦") ? "67%" : "33%";
        const gz = input.match(/å¹²æ”¯[ï¼š\s]*(.*)/)?.[1]?.split(/\s+/) || ["-","-","ä¸å¯"];
        const stage = (gz[2] && gz[2].includes("ä¸") && input.includes("å¯")) ? "æ²æµ´" : "å¹³";
        const five = input.match(/ç«:(\d+)/)?.[1] || 45;

        // 2. æ¸²æŸ“æ„è±¡åœ–æ–‡å­—
        $('#res-score').text(`åˆ†å€¼: ${score}`);
        $('#res-heaven-body').html(`å¤©è±¡ç‰¹å¾µï¼šæª¢æ¸¬åˆ° ${Object.keys(ECI_RULES.Stars).filter(k=>input.includes(k)).join(', ')}ã€‚<br>æ°£é‹åˆ¤å®šï¼š${score < 0 ? 'æ°£æ•¸è™•æ–¼ã€Œè¡°æ¸›ã€ç›¸ä½ï¼Œä¸»æ”¶æ–‚èˆ‡æ²ˆæ½›ã€‚' : 'æ°£æ•¸è™•æ–¼ã€Œæ—ºç››ã€ç›¸ä½ï¼Œä¸»é–‹å±•èˆ‡å‡é¨°ã€‚'}<br>å­—å…¸æ„Ÿæ‡‰ï¼š${Object.keys(ECI_RULES.Dict).filter(k=>input.includes(k)).map(k=>ECI_RULES.Dict[k]).join('ã€')}`);

        $('#res-urg').text(`æ€¥ç·©: ${urg}`);
        $('#res-earth-body').html(`å±€å‹¢æ€¥ç·©ï¼šç•¶å‰æœˆç›¸æŒ‡å‘ã€Œ${urg === '67%' ? 'ä¸‹å¼¦æ€¥è®Š' : 'ä¸Šå¼¦ç·©é€²'}ã€æœŸã€‚<br>è®Šå‹•é¢¨éšªï¼š${urg === '67%' ? 'é«˜é¢¨éšªæ€¥è½‰ï¼Œå®œåœ¨ 3 æ—¥å…§åšå‡ºèª¿æ•´ã€‚' : 'è¶¨å‹¢ç©©å®šï¼Œé©åˆé•·æœŸæŒå®ˆï¼Œä¸å®œé€Ÿæˆã€‚'}<br>åœ°åˆ©å»ºè­°ï¼š${urg==='67%'?'é¿é–‹é‹’èŠ’ï¼Œå°‹æ±‚é¿é¢¨æ¸¯ã€‚':'æŒ‰éƒ¨å°±ç­ï¼Œç©è“„å¯¦åŠ›ã€‚'}`);

        $('#res-stage').text(`ç‹€æ…‹: ${stage}`);
        $('#res-human-body').html(`å€‹é«”é•·ç”Ÿä½ï¼š${stage}ã€‚<br>äº”è¡Œä¸»å°ï¼šç«èƒ½ ${five}%ã€‚${five > 40 ? 'ç«æ°£åæ—ºï¼Œéœ€é˜²æƒ…ç·’åŒ–æ±ºç­–å°è‡´è²¡æã€‚' : 'èƒ½é‡å‡è¡¡ã€‚'}<br>å‘½ç†æ„Ÿæ‡‰ï¼š${gz[2]} æ—¥æŸ±èˆ‡ç•¶å‰æ™‚ç©ºç”¢ç”Ÿ${stage === 'æ²æµ´' ? 'æ´—æ»Œæ•ˆæ‡‰ï¼Œä¸»ç ´èˆŠç«‹æ–°ã€‚' : 'ä¸­åº¸æ„Ÿæ‡‰ã€‚'}`);

        // 3. çµ‚æ¥µæ±ºç­–å¤§åŒ¯ç¸½ (è‹¥ AI å¯ç”¨å‰‡èª¿ç”¨ï¼Œä¸å¯ç”¨å‰‡åœ¨åœ°ç”Ÿæˆ)
        let totalDecision = "";
        if(IS_AI) {
            try {
                const prompt = `åˆ†ææ•¸æ“šï¼šå¾—åˆ†=${score}, æ€¥ç·©=${urg}, é•·ç”Ÿ=${stage}, äº”è¡Œç«=${five}ã€‚è«‹çµ¦å‡º 100 å­—å…§ç²¾ç…‰çš„çµ‚æ¥µæ±ºç­–å»ºè­°ã€‚`;
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`, {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
                });
                const d = await res.json();
                totalDecision = d.candidates[0].content.parts[0].text;
            } catch(e) { totalDecision = `åœ¨åœ°å¼•æ“æ±ºç­–ï¼šå¤©æ™‚${score>0?'å‰':'å‡¶'}ã€åœ°åˆ©${urg==='67%'?'æ€¥':'ç·©'}ã€‚å»ºè­°ï¼š${score<0?'ã€Œå¿ã€é¿ã€å®ˆã€':'ã€Œé€²ã€æ‹“ã€æ”»ã€'}ã€‚`; }
        } else {
            totalDecision = `ã€æ ¸å¿ƒæ±ºç­–ã€‘å¤©æ˜Ÿè©•åˆ† ${score}ï¼Œé…åˆåœ°æ°£ ${urg} æ€¥è®Šã€‚ç›®å‰${score < -10 ? 'å‡¶æ˜Ÿé«˜ç…§' : 'ç¥¥é›²ç± ç½©'}ï¼Œæ—¥æŸ±è™•æ–¼ã€Œ${stage}ã€ã€‚å»ºè­°ï¼š${score < 0 ? 'å…¨ç·šå›é˜²ï¼Œå‰²æ¨åŠ£è³ªè³‡ç”¢ï¼Œéœå¾…æ˜¥é›·ã€‚' : 'å…¨é¢é€²æ”»ï¼ŒæŠŠæ¡ç•¶å‰çª—å£æœŸï¼Œåˆ©è¦‹å¤§äººã€‚'}`;
        }
        $('#res-total-body').text(totalDecision);
        
        const nowStr = new Date().toLocaleDateString();
        $('#v-date1, #v-date2, #v-date3').text(nowStr);

        setTimeout(() => { $('#loader').hide(); goTab(1); }, 1000);
    }

    async function exportImages() {
        const ids = ['v-heaven', 'v-earth', 'v-human', 'v-total'];
        for(let id of ids) {
            const canvas = await html2canvas(document.getElementById(id), { scale: 2 });
            const link = document.createElement('a');
            link.href = canvas.toDataURL();
            link.download = `Summary_${id}_${Date.now()}.png`;
            link.click();
        }
    }

    function downloadCode(){ const b=new Blob([document.documentElement.outerHTML],{type:'text/html'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='Golden_Summary_V16.html'; a.click(); }
    $(document).ready(init);
</script>
</body>
</html>
