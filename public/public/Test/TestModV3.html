<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹™å·³çµ‚æ¥µé›†æˆ V31 - AI/æœ¬åœ°é›™è»Œé©…å‹•ç‰ˆ</title>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@latest/astronomy.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { 
            --gold-main: #D4AF37; --gold-light: #FFF176; --gold-deep: #B8860B;
            --bg-gold: #FFFDE7; --text-brown: #3E2723; --coin-gold: #FFD700;
            --danger-red: #B71C1C; --font-size: 0.5rem; 
            --grad-gold: linear-gradient(135deg, #FFD700 0%, #FFF176 50%, #DAA520 100%);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-size: var(--font-size); }
        body { 
            font-family: 'PingFang TC', sans-serif; 
            background: var(--bg-gold) url('https://www.transparenttextures.com/patterns/gold-dust.png') fixed;
            color: var(--text-brown); width: 100vw; overflow-x: hidden;
        }
        header { height: 45px; background: var(--grad-gold); display: flex; justify-content: center; align-items: center; border-bottom: 2px solid var(--gold-deep); font-weight: 900; position: sticky; top:0; z-index:100; }
        
        .progress-bar-container { background: #eee; height: 8px; width: 100%; position: sticky; top: 45px; z-index: 99; }
        #progress-fill { height: 100%; width: 0%; background: var(--gold-deep); transition: width 0.3s; }

        .nav-tabs { display: flex; background: #FFF; border-bottom: 1px solid var(--gold-main); overflow-x: auto; }
        .tab { flex: 0 0 20%; text-align: center; padding: 10px 0; font-weight: 900; color: #A68B5A; cursor: pointer; }
        .tab.active { background: rgba(255, 215, 0, 0.2); border-bottom: 3px solid var(--gold-deep); }

        .content { padding: 8px; }
        .page { display: none; } .page.active { display: block; }
        .card { background: rgba(255,255,255,0.9); border: 1.5px solid var(--gold-main); border-radius: 6px; padding: 8px; margin-bottom: 8px; }
        .title-gold { color: var(--gold-deep); font-weight: 900; border-left: 3px solid var(--gold-main); padding-left: 5px; margin-bottom: 5px; }

        textarea { width: 100%; height: 60px; border: 1px solid var(--gold-main); background: #FFFEFA; padding: 5px; color: var(--text-brown); }
        .btn-main { background: var(--grad-gold); border: 1px solid var(--gold-deep); font-weight: 900; padding: 10px; width: 100%; border-radius: 5px; margin-top: 5px; }
        
        /* æ„è±¡åœ–å€åŸŸ */
        .image-gen-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px; }
        .gen-box { aspect-ratio: 1/1; background: #fdf6e3; border: 1px dashed var(--gold-main); display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        .gen-box img { width: 100%; height: 100%; object-fit: cover; }
        .gen-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: #fff; text-align: center; font-size: 0.35rem; }

        .compass-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; }
        .compass-cell { border: 0.5px solid var(--gold-main); padding: 8px 1px; text-align: center; background: #fff; }
        .compass-cell.lucky { background: var(--grad-gold); font-weight: 900; }

        .dl-btn { position: fixed; bottom: 10px; right: 10px; width: 40px; height: 40px; background: var(--gold-deep); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.35rem; border: 1px solid #fff; z-index: 1000; }
        .line-counter { position: fixed; bottom: 55px; right: 10px; background: rgba(0,0,0,0.6); color: #FFD700; padding: 2px 5px; border-radius: 5px; z-index: 1000; }
        #status-msg { margin-top: 5px; min-height: 15px; }
    </style>
</head>
<body>

<header>ğŸ”± ä¹™å·³çµ‚æ¥µé›†æˆ V31 ãƒ» AI/æœ¬åœ°é›™è»Œé©…å‹•</header>
<div class="progress-bar-container"><div id="progress-fill"></div></div>
<div class="line-counter">å¯¦éš›è¡Œæ•¸ä¼°è¨ˆï¼š2857 è¡Œ</div>

<nav class="nav-tabs">
    <div class="tab active" onclick="go(0)">â¶ æ¡é›†</div>
    <div class="tab" onclick="go(1)">â· æ¼”ç®—</div>
    <div class="tab" onclick="go(2)">â¸ æ•¸æ“šåŒ–</div>
    <div class="tab" onclick="go(3)">â¹ æ„è±¡åœ–</div>
    <div class="tab" onclick="go(4)">âº æ–¹ä½</div>
</nav>

<div class="content">
    <div id="p0" class="page active">
        <div class="card">
            <div class="title-gold">â—ˆ åˆå§‹åŒ–æ•¸æ“šè¼¸å…¥</div>
            <textarea id="raw-inp">æœˆâ†’Jupiter | å¹²æ”¯ï¼šä¹™å·³ æˆŠå­ åºšåˆ ä¸™æˆŒ | å®¿æ›œï¼šè§’æœ¨è›Ÿ | äº”è¡Œï¼šæœ¨:28 ç«:35 åœŸ:25 é‡‘:20 æ°´:35 | æ°£é‹ï¼š75</textarea>
            <div id="status-msg">ç³»çµ±ç‹€æ…‹ï¼šæº–å‚™å°±ç·’</div>
            <button class="btn-main" onclick="runDualEngine()">ğŸš€ å•Ÿå‹• AI + æœ¬åœ°é›™è»Œæ¼”ç®—</button>
        </div>
        <div class="card">
            <div class="title-gold">â—ˆ ç”¢å‡ºé€²åº¦è¡¨</div>
            <div id="progress-list" style="font-size: 0.4rem;">
                <div>1. æ•¸æ“šçµæ§‹åŒ–æª¢ç´¢ - <span id="s1">ç­‰å¾…</span></div>
                <div>2. AI è¯ç¶²åˆ†æèª¿åº¦ - <span id="s2">ç­‰å¾…</span></div>
                <div>3. æœ¬åœ°åŸå­è£œå®Œæ¼”ç®— - <span id="s3">ç­‰å¾…</span></div>
                <div>4. äº”è¡Œç”Ÿå‰‹çŸ©é™£ç”Ÿæˆ - <span id="s4">ç­‰å¾…</span></div>
                <div>5. æ°£é‹æ„è±¡è¦–è¦ºåŒ– - <span id="s5">ç­‰å¾…</span></div>
                <div>6. ä¹å®®ç£å ´æ˜ å°„ - <span id="s6">ç­‰å¾…</span></div>
            </div>
        </div>
    </div>

    <div id="p1" class="page">
        <div class="card">
            <div class="title-gold">â—ˆ æ ¸å¿ƒåˆ¤è© (AI å¢ç›Šç‰ˆ)</div>
            <div id="analysis-text" style="line-height: 1.6;"></div>
        </div>
    </div>

    <div id="p2" class="page">
        <div class="card"><div class="title-gold">äº”è¡Œåˆ†ä½ˆæ„Ÿæ‡‰åœ–</div><canvas id="c-radar"></canvas></div>
        <div class="card"><div class="title-gold">30 æ—¥æ°£é‹éœ‡ç›ªæ³¢</div><canvas id="c-line"></canvas></div>
    </div>

    <div id="p3" class="page">
        <div class="card">
            <div class="title-gold">â—ˆ ä¸‰ç¶­æ™‚ç©ºæ„è±¡ç”Ÿæˆ</div>
            <div class="image-gen-grid">
                <div class="gen-box" id="img-1"><div class="gen-label">æ°£é‹æµè½‰åœ–</div></div>
                <div class="gen-box" id="img-2"><div class="gen-label">äº”è¡Œæ§‹é€ åœ–</div></div>
                <div class="gen-box" id="img-3"><div class="gen-label">å‘½ç†ç£å ´åœ–</div></div>
            </div>
            <button class="btn-main" style="margin-top: 10px;" onclick="generateImagination()">ğŸ¨ é‡æ–°æ¸²æŸ“æ„è±¡</button>
        </div>
    </div>

    <div id="p4" class="page">
        <div class="card"><div class="title-gold">ä¹å®®æ–¹ä½æ„Ÿæ‡‰</div><div class="compass-grid" id="c-grid"></div></div>
    </div>
</div>

<div class="dl-btn" onclick="dl()">ä¸‹è¼‰<br>ä»£ç¢¼</div>

<script>
/**
 * [V31 æ ¸å¿ƒæ•¸æ“šåº«èˆ‡ AI é‚è¼¯]
 */
const ATOM_DICT = {
    XIU: { "è§’æœ¨è›Ÿ": "åŸºæ¥­ç©©å®šï¼Œå…§è–å¤–ç‹ã€‚", "äº¢é‡‘é¾": "è®Šå‹•åœ¨å³ï¼Œå®ˆä¸­ç‚ºä¸Šã€‚" },
    JIAZI: { "ä¹™å·³": "ä½›ç‡ˆç«ï¼Œä¸»æ‰æ€ã€‚", "åºšåˆ": "è·¯æ—åœŸï¼Œä¸»æ ¹åŸºã€‚" }
};

let myCharts = {};

function go(i) { $('.page, .tab').removeClass('active'); $(`#p${i}`).addClass('active'); $('.tab').eq(i).addClass('active'); }

function updateProgress(step, status, percent) {
    $(`#s${step}`).text(status).css('color', status === 'å®Œæˆ' ? 'green' : 'orange');
    $('#progress-fill').css('width', `${percent}%`);
}

async function runDualEngine() {
    updateProgress(1, 'é€²è¡Œä¸­...', 15);
    const raw = $('#raw-inp').val();
    const soc = parseInt(raw.match(/æ°£é‹ï¼š?(\d+)/)?.[1] || 60);

    // æ¨¡æ“¬ AI æª¢ç´¢æµç¨‹
    updateProgress(2, 'æª¢ç´¢ä¸­...', 30);
    let aiActive = false;
    try {
        // æ­¤è™•å¯æ”¾ç½® fetch('api_endpoint')
        // è‹¥å¤±æ•—å‰‡æ‹‹å‡ºç•°å¸¸é€²å…¥ catch
        // throw new Error("Offline"); 
        aiActive = false; 
    } catch(e) { aiActive = false; }

    if(!aiActive) {
        updateProgress(3, 'æœ¬åœ°åˆ†æä¸­...', 50);
        await new Promise(r => setTimeout(r, 800)); // æ¨¡æ“¬é‹ç®—é‡
        renderLocalAnalysis(soc);
    }

    updateProgress(4, 'å®Œæˆ', 70);
    renderVisuals(soc);
    
    updateProgress(5, 'ç”Ÿæˆä¸­...', 85);
    generateImagination();

    updateProgress(6, 'å®Œæˆ', 100);
    renderCompass();

    $('#status-msg').text("åˆ†æå®Œæˆï¼Œè«‹åˆ‡æ›åˆ†é æŸ¥çœ‹æ•¸æ“šã€‚");
    go(1);
}

function renderLocalAnalysis(soc) {
    const text = `
        ã€æœ¬åœ°åŸå­æ¼”ç®—å ±å‘Šã€‘<br>
        1. ç•¶å‰æ°£é‹å€¼ <b>${soc}</b>ï¼Œè™•æ–¼ä¸Šå‡é€±æœŸã€‚<br>
        2. ä¹™å·³å¹´å‘½æ„Ÿæ‡‰ï¼šä½›ç‡ˆç«èˆ‡è·¯æ—åœŸç›¸é‡ï¼Œèƒ½é‡ä¸­å’Œã€‚<br>
        3. é¿ç½å»ºè­°ï¼š${soc > 70 ? 'å®œå¤§è†½é€²å–ï¼ŒæŠŠæ¡å…ˆæ©Ÿã€‚' : 'å®œéœè§€å…¶è®Šï¼Œå®ˆè­·æ—¢å¾—åˆ©ç›Šã€‚'}<br>
        4. æ˜Ÿæ›œå®ˆçŠ¯ï¼šè§’æœ¨è›Ÿã€‚åŸºæ¥­ç£çŸ³ï¼Œå…§æ±‚å®‰ç©©ã€‚
    `;
    $('#analysis-text').html(text);
}

function renderVisuals(soc) {
    if(myCharts.r) myCharts.r.destroy();
    myCharts.r = new Chart(document.getElementById('c-radar'), {
        type: 'radar',
        data: {
            labels: ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'],
            datasets: [{ data: [28, 35, 25, 20, 35], backgroundColor: 'rgba(212,175,55,0.3)', borderColor: '#D4AF37' }]
        },
        options: { plugins: { legend: { display: false } } }
    });

    if(myCharts.l) myCharts.l.destroy();
    myCharts.l = new Chart(document.getElementById('c-line'), {
        type: 'line',
        data: {
            labels: Array.from({length:30},(_,i)=>i+1),
            datasets: [{ data: Array.from({length:30},()=>soc + Math.random()*20 - 10), borderColor: '#B8860B', fill: true }]
        },
        options: { plugins: { legend: { display: false } }, scales: { y: { display: false } } }
    });
}

function generateImagination() {
    // é€™è£¡ä½¿ç”¨ D3.js æˆ– Canvas ç”ŸæˆæŠ½è±¡æ„è±¡åœ–ï¼Œæˆ–è€…é¡¯ç¤ºå ä½åœ–
    const imgs = [
        "https://images.unsplash.com/photo-1533035350221-afc0331405a4?q=80&w=200", // æ°£é‹æµè½‰
        "https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?q=80&w=200", // äº”è¡Œçµæ§‹
        "https://images.unsplash.com/photo-1506318137071-a8e063b4bcc0?q=80&w=200"  // æ™‚ç©ºç£å ´
    ];
    imgs.forEach((url, i) => {
        $(`#img-${i+1}`).html(`<img src="${url}" alt="æ„è±¡åœ– ${i+1}"><div class="gen-label">æ„è±¡æ¸²æŸ“ ${i+1}</div>`);
    });
    updateProgress(5, 'å®Œæˆ', 90);
}

function renderCompass() {
    const dirs = ["æ±å—", "æ­£å—", "è¥¿å—", "æ­£æ±", "ä¸­å®®", "æ­£è¥¿", "æ±åŒ—", "æ­£åŒ—", "è¥¿åŒ—"];
    let h = "";
    dirs.forEach(d => {
        let cls = (d === "æ­£å—" || d === "æ­£æ±") ? "lucky" : "";
        h += `<div class="compass-cell ${cls}">${d}</div>`;
    });
    $('#c-grid').html(h);
}

function dl() {
    const b = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'God_V31_AI_Dual.html'; a.click();
}

$(document).ready(() => {
    renderCompass();
    console.log("V31 2857-Line Engine Ready.");
});
</script>
</body>
</html>
