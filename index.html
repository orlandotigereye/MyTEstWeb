<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netlify æ•´åˆç®¡ç†é¢æ¿</title>
    <style>
        :root {
            --gold-primary: #ffd700;
            --gold-dark: #b8860b;
            --gold-light: #fffacd;
            --text-size: 0.5rem; /* åš´æ ¼æ§åˆ¶ 0.5rem */
        }
        body {
            background: radial-gradient(circle, #ffec8b, #daa520, #8b6508);
            background-attachment: fixed;
            color: #333;
            font-family: "Microsoft JhengHei", sans-serif;
            font-size: var(--text-size);
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        .container {
            width: 100%; max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--gold-primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            border-radius: 8px; padding: 10px; box-sizing: border-box;
        }
        .header { text-align: center; margin-bottom: 10px; }
        h1 { font-size: 0.8rem; color: var(--gold-dark); margin: 5px 0; text-shadow: 1px 1px 1px #fff; }
        
        /* Tab å°è¦½ */
        .tabs { display: flex; gap: 5px; margin-bottom: 10px; border-bottom: 2px solid var(--gold-primary); }
        .tab-btn { 
            padding: 5px 10px; cursor: pointer; background: var(--gold-light); 
            border: 1px solid var(--gold-dark); border-bottom: none; font-size: var(--text-size);
            border-radius: 4px 4px 0 0;
        }
        .tab-btn.active { background: var(--gold-primary); font-weight: bold; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-in; }
        .tab-content.active { display: block; }

        /* æŒ‰éˆ•èˆ‡æ¸…å–®æ¨£å¼ */
        .btn {
            padding: 4px 10px; background: linear-gradient(to bottom, #ffd700, #b8860b);
            color: white; border: 1px solid #8b6508; border-radius: 3px; cursor: pointer; font-size: var(--text-size);
        }
        pre { 
            background: #272822; color: #f8f8f2; padding: 8px; border-radius: 4px; 
            overflow-x: auto; font-size: 0.45rem; border-left: 5px solid var(--gold-primary);
        }
        .list-group { list-style: none; padding: 0; margin: 0; border: 1px solid #ddd; }
        .list-item { display: flex; align-items: center; padding: 6px; border-bottom: 1px solid #eee; }
        .list-item:hover { background: var(--gold-light); }
        .list-item a { text-decoration: none; color: #0056b3; flex: 1; }

        .pagination { display: flex; justify-content: center; gap: 3px; margin-top: 10px; }
        .pagination button { padding: 2px 5px; font-size: var(--text-size); cursor: pointer; background: #fff; border: 1px solid var(--gold-dark); }
        .pagination button.active { background: var(--gold-primary); color: white; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>âœ¨ Netlify é›²ç«¯ç®¡ç†é¢æ¿ âœ¨</h1>
        <button class="btn" id="dl-btn">â¬‡ï¸ ä¸‹è¼‰æ­¤é åŸå§‹ç¢¼</button>
    </div>

    <div class="tabs">
        <div class="tab-btn active" onclick="switchTab(event, 'file-tab')">ğŸ“ æª”æ¡ˆç´¢å¼•</div>
        <div class="tab-btn" onclick="switchTab(event, 'api-tab')">âš™ï¸ Function æ¸¬è©¦</div>
    </div>

    <div id="file-tab" class="tab-content active">
        <div id="f-status" style="background:#fff3cd; padding:4px; margin-bottom:5px;">æ­£åœ¨è®€å– GitHub æ¸…å–®...</div>
        <ul id="f-list" class="list-group"></ul>
        <div id="f-pagination" class="pagination"></div>
    </div>

    <div id="api-tab" class="tab-content">
        <h3>Serverless Function ç‹€æ…‹</h3>
        <p>å‘¼å«è·¯å¾‘: <code>/.netlify/functions/hello</code></p>
        <button class="btn" onclick="callFunction()">ğŸš€ ç«‹å³å‘¼å« Function</button>
        <pre id="api-res">ç­‰å¾…åŸ·è¡Œ...</pre>
    </div>
</div>

<script>
const GITHUB_CFG = {
    OWNER: 'orlandotigereye',
    REPO: 'mytestweb',
    PATH: 'public/public',
    PAGE_SIZE: 10
};
let allFiles = [];

// åˆ†é åˆ‡æ›
function switchTab(e, id) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    e.currentTarget.classList.add('active');
}

// 1. GitHub æª”æ¡ˆç´¢å¼•é‚è¼¯
async function loadFiles() {
    const status = document.getElementById('f-status');
    try {
        const res = await fetch(`https://api.github.com/repos/${GITHUB_CFG.OWNER}/${GITHUB_CFG.REPO}/contents/${GITHUB_CFG.PATH}`);
        if (!res.ok) throw new Error('ç„¡æ³•å–å¾— GitHub è³‡æ–™');
        allFiles = await res.json();
        status.innerText = `âœ… è®€å–æˆåŠŸ: å…± ${allFiles.length} å€‹é …ç›®`;
        renderFiles(1);
    } catch (err) {
        status.innerText = 'âŒ éŒ¯èª¤: ' + err.message;
        status.style.color = 'red';
    }
}

function renderFiles(page) {
    const list = document.getElementById('f-list');
    const pag = document.getElementById('f-pagination');
    list.innerHTML = '';
    const start = (page - 1) * GITHUB_CFG.PAGE_SIZE;
    const items = allFiles.slice(start, start + GITHUB_CFG.PAGE_SIZE);

    items.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-item';
        // ä½¿ç”¨ GitHub Pages ç¶²å€é€²è¡Œè·³è½‰
        const url = `https://${GITHUB_CFG.OWNER}.github.io/${GITHUB_CFG.REPO}/${item.path}`;
        li.innerHTML = `<span>${item.type==='dir'?'ğŸ“':'ğŸ“„'}</span>&nbsp;<a href="${url}" target="_blank">${item.name}</a>`;
        list.appendChild(li);
    });

    pag.innerHTML = '';
    const total = Math.ceil(allFiles.length / GITHUB_CFG.PAGE_SIZE);
    for (let i = 1; i <= total; i++) {
        const btn = document.createElement('button');
        btn.innerText = i;
        if (i === page) btn.className = 'active';
        btn.onclick = () => renderFiles(i);
        pag.appendChild(btn);
    }
}

// 2. Netlify Function æ¸¬è©¦é‚è¼¯ (ä½¿ç”¨ç›¸å°è·¯å¾‘)
async function callFunction() {
    const resBox = document.getElementById('api-res');
    resBox.textContent = 'ğŸ“¡ æ­£åœ¨é€£ç·šè‡³æœ¬æ©Ÿ Functions...';
    try {
        const response = await fetch('/.netlify/functions/hello');
        if (!response.ok) throw new Error(`HTTP ${response.status}: è«‹ç¢ºèªæª”æ¡ˆå·²éƒ¨ç½²è‡³ Netlify`);
        const data = await response.json();
        resBox.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        resBox.textContent = 'âš ï¸ å‘¼å«å¤±æ•—: ' + err.message;
    }
}

// 3. ä¸‹è¼‰ç¨‹å¼ç¢¼æŒ‰éˆ•
document.getElementById('dl-btn').onclick = () => {
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
    const a = Object.assign(document.createElement('a'), { 
        href: URL.createObjectURL(blob), 
        download: 'netlify_admin.html' 
    });
    a.click();
};

// åˆå§‹åŒ–
loadFiles();
</script>
</body>
</html>
