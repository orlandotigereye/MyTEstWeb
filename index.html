<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•´åˆç´¢å¼•é¢æ¿ (å«è©³ç´°å‚™è¨»)</title>
    <style>
        /* å®šç¾©å…¨åŸŸè®Šæ•¸èˆ‡å­—é«”å¤§å° */
        :root {
            --gold-primary: #ffd700;
            --gold-dark: #b8860b;
            --gold-light: #fffacd;
            --text-size: 0.5rem; /* åš´æ ¼æ§åˆ¶ 0.5rem */
        }
        
        /* èƒŒæ™¯è¨­å®šï¼šé‡‘å¹£è¼ç…Œèˆ‡é‡‘å…‰é–ƒé–ƒè¦–è¦º */
        body {
            background: radial-gradient(circle, #ffec8b, #daa520, #8b6508);
            background-attachment: fixed;
            color: #333;
            font-family: "Microsoft JhengHei", sans-serif;
            font-size: var(--text-size);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* ä¸»å®¹å™¨ RWD èˆ‡é™°å½±ç‰¹æ•ˆ */
        .container {
            width: 100%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--gold-primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), inset 0 0 10px rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .header { text-align: center; margin-bottom: 10px; }
        h1 { font-size: 0.8rem; color: var(--gold-dark); margin: 5px 0; text-shadow: 1px 1px 1px #fff; }

        /* åˆ†é æ¨™ç±¤æ¨£å¼ */
        .tabs { display: flex; gap: 5px; margin-bottom: 10px; border-bottom: 2px solid var(--gold-primary); }
        .tab-btn { 
            padding: 5px 10px; cursor: pointer; background: var(--gold-light); 
            border: 1px solid var(--gold-dark); border-bottom: none; font-size: var(--text-size);
            border-radius: 5px 5px 0 0;
        }
        .tab-btn.active { background: var(--gold-primary); font-weight: bold; color: #fff; }

        /* å…§å®¹å€å¡Šé¡¯ç¤ºæ§åˆ¶ */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }

        /* é€šç”¨æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 4px 10px; background: linear-gradient(to bottom, #ffd700, #b8860b);
            color: #fff; border: 1px solid #8b6508; border-radius: 3px; cursor: pointer; 
            font-size: var(--text-size); margin: 2px;
        }
        .btn:hover { filter: brightness(1.1); }

        /* ç¨‹å¼ç¢¼èˆ‡çµæœé¡¯ç¤ºå€ */
        pre { 
            background: #272822; color: #f8f8f2; padding: 8px; border-radius: 4px; 
            overflow-x: auto; font-size: 0.45rem; line-height: 1.2;
            border-left: 5px solid var(--gold-primary);
        }

        /* æª”æ¡ˆåˆ—è¡¨æ¨£å¼ */
        .list-group { list-style: none; padding: 0; margin: 0; border: 1px solid #ddd; border-radius: 4px; }
        .list-item { 
            display: flex; align-items: center; padding: 6px; border-bottom: 1px solid #eee; 
            transition: 0.2s;
        }
        .list-item:last-child { border-bottom: none; }
        .list-item:hover { background: var(--gold-light); }
        .list-item a { text-decoration: none; color: #0056b3; flex: 1; word-break: break-all; }

        /* åˆ†é æ§åˆ¶é … */
        .pagination { display: flex; justify-content: center; gap: 3px; margin-top: 10px; flex-wrap: wrap; }
        .pagination button { 
            padding: 3px 7px; font-size: var(--text-size); cursor: pointer; 
            background: #fff; border: 1px solid var(--gold-dark);
        }
        .pagination button.active { background: var(--gold-primary); color: white; border-color: #b8860b; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>âœ¨ è¬èƒ½ç®¡ç†ç´¢å¼•é¢æ¿ (æ•´åˆç‰ˆ) âœ¨</h1>
        <button class="btn" id="dl-btn">â¬‡ï¸ ä¸‹è¼‰æ­¤é åŸå§‹ç¢¼</button>
    </div>

    <div class="tabs">
        <div class="tab-btn active" onclick="showTab(event, 'file-tab')">GitHub æª”æ¡ˆåº«</div>
        <div class="tab-btn" onclick="showTab(event, 'api-tab')">Netlify åŠŸèƒ½æ¸¬è©¦</div>
    </div>

    <div id="file-tab" class="tab-content active">
        <div id="file-status" style="background:#fff3cd; padding:4px; margin-bottom:5px; border-radius:3px;">
            ğŸ“¡ ç‹€æ…‹ï¼šæ­£åœ¨å¾ GitHub ç²å–æ¸…å–®...
        </div>
        <ul id="file-list" class="list-group"></ul>
        <div id="file-pagination" class="pagination"></div>
    </div>

    <div id="api-tab" class="tab-content">
        <div style="background: rgba(218, 165, 32, 0.1); padding: 10px; border-radius: 5px;">
            <h3>Serverless Function æ¸¬è©¦</h3>
            <p>ç›®çš„ï¼šæ¸¬è©¦ /.netlify/functions/hello æ˜¯å¦é‹ä½œæ­£å¸¸ã€‚</p>
            <button class="btn" id="callFunction">ğŸš€ ç«‹å³å‘¼å« Function</button>
            <p>å›æ‡‰çµæœï¼š</p>
            <pre id="api-result">ç­‰å¾…æŒ‡ä»¤ä¸­...</pre>
        </div>
    </div>
</div>

<script>
/**
 * é…ç½®åƒæ•¸å€
 */
const CONFIG = {
    OWNER: 'orlandotigereye',
    REPO: 'mytestweb',
    PATH: 'public/public', // ç›®æ¨™ç›®éŒ„
    API_URL: function() { return `https://api.github.com/repos/${this.OWNER}/${this.REPO}/contents/${this.PATH}`; },
    PAGE_SIZE: 10 // æ¯é é¡¯ç¤º 10 ç­†
};

let fileDataStore = []; // å„²å­˜æ‰€æœ‰æª”æ¡ˆè³‡æ–™

/**
 * åˆ†é åˆ‡æ›é‚è¼¯ (Tab Switch)
 */
function showTab(event, tabId) {
    // éš±è—æ‰€æœ‰åˆ†é å…§å®¹
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•å•Ÿç”¨ç‹€æ…‹
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    // é¡¯ç¤ºç›®æ¨™åˆ†é ä¸¦æ¨™è¨˜æŒ‰éˆ•
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');
}

/**
 * GitHub API æŠ“å–é‚è¼¯
 */
async function fetchGithubFiles() {
    const statusEl = document.getElementById('file-status');
    try {
        const response = await fetch(CONFIG.API_URL());
        if (!response.ok) throw new Error('ç„¡æ³•å­˜å– GitHub API (å¯èƒ½è¶…éæ¬¡æ•¸æˆ–è·¯å¾‘éŒ¯èª¤)');
        
        const data = await response.json();
        
        // æ’åºï¼šè®“è³‡æ–™å¤¾ (dir) å„ªå…ˆæ–¼æª”æ¡ˆ (file)ï¼Œç„¶å¾ŒæŒ‰åç¨± A-Z
        fileDataStore = data.sort((a, b) => {
            if (a.type === b.type) return a.name.localeCompare(b.name);
            return a.type === 'dir' ? -1 : 1;
        });

        statusEl.innerText = `âœ… æˆåŠŸè¼‰å…¥ ${fileDataStore.length} å€‹é …ç›®`;
        renderFilePage(1); // åˆå§‹åŒ–é¡¯ç¤ºç¬¬ä¸€é 
    } catch (err) {
        statusEl.style.color = 'red';
        statusEl.innerText = 'âŒ éŒ¯èª¤: ' + err.message;
    }
}

/**
 * æ¸²æŸ“ç‰¹å®šåˆ†é çš„æª”æ¡ˆåˆ—è¡¨
 * @param {number} page é ç¢¼
 */
function renderFilePage(page) {
    const listEl = document.getElementById('file-list');
    const pagEl = document.getElementById('file-pagination');
    listEl.innerHTML = '';
    
    // è¨ˆç®—ç•¶å‰é é¢çš„è³‡æ–™ç¯„åœ
    const start = (page - 1) * CONFIG.PAGE_SIZE;
    const end = start + CONFIG.PAGE_SIZE;
    const itemsToShow = fileDataStore.slice(start, end);

    itemsToShow.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-item';
        const icon = item.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
        // å»ºç«‹ GitHub Pages çš„ Web é€£çµ
        const webUrl = `https://${CONFIG.OWNER}.github.io/${CONFIG.REPO}/${item.path}`;
        
        li.innerHTML = `
            <span style="margin-right:8px;">${icon}</span>
            <a href="${webUrl}" target="_blank" title="${item.path}">${item.name}</a>
        `;
        listEl.appendChild(li);
    });

    // å»ºç«‹åˆ†é æŒ‰éˆ•æŒ‰éˆ•
    pagEl.innerHTML = '';
    const totalPages = Math.ceil(fileDataStore.length / CONFIG.PAGE_SIZE);
    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.innerText = i;
        if (i === page) btn.className = 'active';
        btn.onclick = () => renderFilePage(i);
        pagEl.appendChild(btn);
    }
}

/**
 * Netlify Function å‘¼å«é‚è¼¯
 */
document.getElementById('callFunction').addEventListener('click', async () => {
    const resBox = document.getElementById('api-result');
    resBox.textContent = 'ğŸ“¡ æ­£åœ¨é€£ç·šè‡³ Serverless Function...';
    try {
        const response = await fetch('/.netlify/functions/hello');
        if (!response.ok) throw new Error('Function æœªéƒ¨ç½²æˆ–è·¯å¾‘ä¸æ­£ç¢º');
        const data = await response.json();
        resBox.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        // ä¸ä½¿ç”¨ alertï¼ŒéŒ¯èª¤ç›´æ¥é¡¯ç¤ºåœ¨ç•«é¢ä¸Š
        resBox.textContent = 'âš ï¸ å‘¼å«å¤±æ•—: ' + err.message + '\n(å‚™è¨»ï¼šæ­¤åŠŸèƒ½åƒ…åœ¨ Netlify ç’°å¢ƒæœ‰æ•ˆ)';
    }
});

/**
 * ç¨‹å¼ç¢¼ä¸‹è¼‰åŠŸèƒ½
 */
document.getElementById('dl-btn').addEventListener('click', (e) => {
    e.preventDefault();
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'admin_index.html';
    a.click();
    URL.revokeObjectURL(url);
});

// åˆå§‹åŒ–ï¼šå•Ÿå‹• GitHub æŠ“å–
fetchGithubFiles();

</script>
</body>
</html>
